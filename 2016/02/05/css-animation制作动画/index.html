<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta http-equiv="Cache-Control" content="max-age=86400" />
<meta name="baidu-site-verification" content="I3b2hxwJQe" />

<!-- <meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" /> -->






  <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="詹方的个人博客" />



  <meta name="keywords" content="css," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="在家快冻疯了，打字好冷，最近在看 手淘年货节舞龙揭幕动画实战 发现animation做动画很简单

下面直接转载一篇讲steps的文章，文章地址 https://idiotwu.me/understanding-css3-timing-function-steps/#toc-5

不堪回首的过往在应用 CSS3 渐变/动画时，有个控制时间的属性 。它的取值中除了常用到的 三次贝塞尔曲线 以外，还有">
<meta property="og:type" content="article">
<meta property="og:title" content="CSS3 timing-function steps() 详解(转载)">
<meta property="og:url" content="http://www.demozhan.com/2016/02/05/css-animation制作动画/index.html">
<meta property="og:site_name" content="Fang -.-">
<meta property="og:description" content="在家快冻疯了，打字好冷，最近在看 手淘年货节舞龙揭幕动画实战 发现animation做动画很简单

下面直接转载一篇讲steps的文章，文章地址 https://idiotwu.me/understanding-css3-timing-function-steps/#toc-5

不堪回首的过往在应用 CSS3 渐变/动画时，有个控制时间的属性 。它的取值中除了常用到的 三次贝塞尔曲线 以外，还有">
<meta property="og:image" content="http://7xltvd.com1.z0.glb.clouddn.com/steps-3-start.png">
<meta property="og:image" content="http://7xltvd.com1.z0.glb.clouddn.com/steps-3-end.png">
<meta property="og:updated_time" content="2016-02-06T09:29:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CSS3 timing-function steps() 详解(转载)">
<meta name="twitter:description" content="在家快冻疯了，打字好冷，最近在看 手淘年货节舞龙揭幕动画实战 发现animation做动画很简单

下面直接转载一篇讲steps的文章，文章地址 https://idiotwu.me/understanding-css3-timing-function-steps/#toc-5

不堪回首的过往在应用 CSS3 渐变/动画时，有个控制时间的属性 。它的取值中除了常用到的 三次贝塞尔曲线 以外，还有">
<meta name="twitter:image" content="http://7xltvd.com1.z0.glb.clouddn.com/steps-3-start.png">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> CSS3 timing-function steps() 详解(转载) | Fang -.- </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f060a37ef3c67e7d80e0730ccf4c5f23";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Fang -.-</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            <i class="menu-item-icon icon-next-commonweal"></i> <br />
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','http://7xltvd.com1.z0.glb.clouddn.com/swifty_st.js','_st');

  _st('install', '8paz1yFszaADHgDv8F_P','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              CSS3 timing-function steps() 详解(转载)
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-05T22:37:52+08:00" content="2016-02-05">
            2016-02-05
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/02/05/css-animation制作动画/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/05/css-animation制作动画/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>在家快冻疯了，打字好冷，最近在看 <a href="http://www.w3cplus.com/animation/dragon-dance-opening-animation.html" title="手淘年货节舞龙揭幕动画实战" target="_blank" rel="external">手淘年货节舞龙揭幕动画实战</a> 发现animation做动画很简单</p>
<blockquote>
<p>下面直接转载一篇讲steps的文章，文章地址 <a href="https://idiotwu.me/understanding-css3-timing-function-steps/#toc-5" target="_blank" rel="external">https://idiotwu.me/understanding-css3-timing-function-steps/#toc-5</a></p>
</blockquote>
<h2 id="不堪回首的过往"><a href="#不堪回首的过往" class="headerlink" title="不堪回首的过往"></a>不堪回首的过往</h2><p>在应用 CSS3 渐变/动画时，有个控制时间的属性 <timing-function>。它的取值中除了常用到的 <a href="http://cubic-bezier.com/#.25,.1,.25,1" title="三次贝塞尔曲线" target="_blank" rel="external">三次贝塞尔曲线</a> 以外，还有个让人比较困惑的 steps() 函数。在许多相关文章里，关于这个函数的解释都比较含糊其辞，比如：</timing-function></p>
<blockquote>
<p>steps() 第一个参数 number 为指定的间隔数，即把动画分为 n 步阶段性展示，第二个参数默认为 end，设置最后一步的状态，start 为结束时的状态，end 为开始时的状态。</p>
</blockquote>
<p>又如：</p>
<blockquote>
<p>steps 有两个参数</p>
<p>第一个肯定是分几步执行完<br>第二个有两个值<br>  start 第一帧是第一步动画结束<br>  end 第一帧是第一步动画开始</p>
</blockquote>
<p>年少无知的我轻易就相信了大家的说法，每次应用 steps() 函数时都要先考虑一番：嗯，start 对应末态，end 对应初态，末态是 OOOO，初态是 XXXX……卧槽！跑起来不对！</p>
<h2 id="一探究竟"><a href="#一探究竟" class="headerlink" title="一探究竟"></a>一探究竟</h2><p>被坑得团团转之后，只好向组织求助。于是查到了这样的规定：</p>
<blockquote>
<p>steps: specifies a stepping function, described above, taking two parameters. The first parameter specifies the number of intervals in the function. It must be a positive integer (greater than 0). The second parameter, which is optional, is either the value ‘start’ or ‘end’, and specifies the point at which the change of values occur within the interval. If the second parameter is omitted, it is given the value ‘end’.</p>
</blockquote>
<p>粗略翻译如下：<strong>steps 函数指定了一个阶跃函数，第一个参数指定了时间函数中的间隔数量（必须是正整数）；第二个参数可选，接受 start 和 end 两个值，指定在每个间隔的起点或是终点发生阶跃变化，默认为 end。</strong></p>
<p>这样理解起来可能还是有点抽象，我们来个实例：</p>
<pre><code>#demo {
  animation-iteration-count: 2;
  animation-duration: 3s;
}
</code></pre><p>这是一个 3s * 2 的动画，我们分别对它应用 steps(3, start) 和 steps(3, end)，做出阶跃函数曲线如下：</p>
<h3 id="steps-3-start"><a href="#steps-3-start" class="headerlink" title="steps(3, start)"></a>steps(3, start)</h3><p><img src="http://7xltvd.com1.z0.glb.clouddn.com/steps-3-start.png" alt="Alt" title="start"></p>
<p>steps() 第一个参数将动画分割成三段。当指定跃点为 start 时，动画在每个计时周期的起点发生阶跃（即图中空心圆 → 实心圆）。<strong>由于第一次阶跃发生在第一个计时周期的起点处（0s），所以我们看到的第一步动画（初态）就为 1/3 的状态，因此在视觉上动画的过程为 1/3 → 2/3 → 1 。</strong></p>
<p>如果翻译成 JavaScript，大致如下：</p>
<pre><code>var animateAtStart = function (steps, duration) {  
    var current = 0;
    var interval = duration / steps;
    var timer = function () {
        current++;
        applyStylesAtStep(current);
        if (current &lt; steps) {
            setTimeout(timer, interval);
        }
    };
    timer();
};
</code></pre><h3 id="steps-3-end"><a href="#steps-3-end" class="headerlink" title="steps(3, end)"></a>steps(3, end)</h3><p><img src="http://7xltvd.com1.z0.glb.clouddn.com/steps-3-end.png" alt="Alt" title="end"></p>
<p>当指定跃点为 end，<strong>动画则在每个计时周期的终点发生阶跃（即图中空心圆 → 实心圆）。由于第一次阶跃发生在第一个计时周期结束时（1s），所以我们看到的初态为 0% 的状态；而在整个动画周期完成处（3s），虽然发生阶跃跳到了 100% 的状态，但同时动画结束，所以 100% 的状态不可视。因此在视觉上动画的过程为 0 → 1/3 → 2/3</strong>（回忆一下数电里的异步清零，当所有输出端都为高电平的时候触发清零，所以全为高电平是暂态）。</p>
<p>同样翻译成 JavaScript 如下：</p>
<pre><code>var animateAtEnd = function (steps, duration) {  
    var current = 0;
    var interval = duration / steps;
    var timer = function () {
        applyStylesAtStep(current);
        current++;
        if (current &lt; steps) {
            setTimeout(timer, interval);
        }
    };
    timer();
};
</code></pre><p>如果这样的解释还是让你觉得云里雾里，可以参考 <a href="https://idiotwu.me/study/timing-function/" title="交互 DEMO" target="_blank" rel="external">交互 DEMO</a></p>
<h2 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h2><p>虽然写了这么多，但还是不得不说一句 timing-function: steps() 在实际设计中的应用少之又少，但是配合一些奇淫技巧还是能做出一些不错的效果：</p>
<h3 id="定时遮罩"><a href="#定时遮罩" class="headerlink" title="定时遮罩"></a>定时遮罩</h3><p>在CSS3 环形进度条这篇文章里，我们曾用到 timing-function 来使半圆环定时显示/隐藏：</p>
<pre><code>$precent: 5; // 进度百分比
$duration: 2s; // 动画时长
@keyframes toggle {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}
.progress-right {
    // 初态为 opacity: 0; 动画周期结束后为 opacity: 1;
    opacity: 1;
    animation: toggle ($duration * 50 / $precent) step-end; // step-end = steps(1, end)
}
.progress-cover {
    // 初态为 opacity: 1; 动画周期结束后为 opacity: 0;
    opacity: 0;
    animation: toggle ($duration * 50 / $precent) step-start; // step-start = steps(1, start)
}
</code></pre><p>这里的关键是使用了 step-start 与 step-end 控制动画，因为动画只有两个关键帧，参考上文可以得出：</p>
<blockquote>
<p>step-start：动画一开始就跳到 100% 直到周期结束</p>
<p>step-end：保持 0% 的样式直到周期结束</p>
</blockquote>
<p>要注意的是，timing-function 是作用于每两个关键帧之间，而不是整个动画（the ‘animation-timing-function’ applies between keyframes, not over the entire animation），所以就有了张鑫旭老师在小tip: CSS3 animation渐进实现点点点等待提示效果一文中得出的结论：</p>
<blockquote>
<p>step-start, 顾名思意，“一步一步开始”，表现在动画中就是一帧一帧播放、一顿一顿画面</p>
</blockquote>
<h3 id="Sprite-精灵动画"><a href="#Sprite-精灵动画" class="headerlink" title="Sprite 精灵动画"></a>Sprite 精灵动画</h3><p>在CSS3 实现奔跑动画这篇文章里，我们使用 CSS3 Animation 来实现游戏开发中的精灵动画：</p>
<pre><code>$spriteWidth: 140px; // 精灵宽度 
@keyframes run {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: -($spriteWidth * 12) 0; // 12帧
  }
}
#sprite {
  width: $spriteWidth;
  height: 144px;
  background: url(&quot;../images/sprite.png&quot;) 0 0 no-repeat;
  animation: run 0.6s steps(12) infinite;
}
</code></pre><p>其原理是：使用一张含有多帧静态画面的图片，通过切换 background-position 使其变为连续的动画。</p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p><a href="http://jsbin.com/daluqov/1" target="_blank" rel="external">http://jsbin.com/daluqov/1</a></p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/css/" rel="tag">#css</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/02/10/html-css-javascript-weekly/" rel="prev">html css javascript weekly</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/01/28/settimeout-setInterval传递参数/" rel="next">settimeout/setInterval传递参数</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2016/02/05/css-animation制作动画/"
                   data-title="CSS3 timing-function steps() 详解(转载)" data-url="http://www.demozhan.com/2016/02/05/css-animation制作动画/">
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table Of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://7xltvd.com1.z0.glb.clouddn.com/default_avatar.jpg" alt="zhanfang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">zhanfang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">詹方的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">145</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">categories</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">79</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhanfang" target="_blank">GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2840048377/profile?topnav=1&wvr=6" target="_blank">Weibo</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.demozhan.com/default" target="_blank">我的作品</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#不堪回首的过往"><span class="nav-number">1.</span> <span class="nav-text">不堪回首的过往</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一探究竟"><span class="nav-number">2.</span> <span class="nav-text">一探究竟</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#steps-3-start"><span class="nav-number">2.1.</span> <span class="nav-text">steps(3, start)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#steps-3-end"><span class="nav-number">2.2.</span> <span class="nav-text">steps(3, end)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实际应用"><span class="nav-number">3.</span> <span class="nav-text">实际应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定时遮罩"><span class="nav-number">3.1.</span> <span class="nav-text">定时遮罩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sprite-精灵动画"><span class="nav-number">3.2.</span> <span class="nav-text">Sprite 精灵动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#demo"><span class="nav-number">3.3.</span> <span class="nav-text">demo</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhanfang</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
<div class="theme-info">© zhanfang 2015 陕ICP备15014665号-1</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhanfang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>

  <script>
    (function(){
        var bp = document.createElement('script');
        bp.src = '//push.zhanzhang.baidu.com/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
  </script>

</body>
</html>
