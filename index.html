<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta http-equiv="Cache-Control" content="max-age=86400" />
<meta name="baidu-site-verification" content="I3b2hxwJQe" />

<!-- <meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" /> -->






  <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="詹方的个人博客" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="詹方的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Fang -.-">
<meta property="og:url" content="http://www.demozhan.com/index.html">
<meta property="og:site_name" content="Fang -.-">
<meta property="og:description" content="詹方的个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fang -.-">
<meta name="twitter:description" content="詹方的个人博客">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> Fang -.- </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f060a37ef3c67e7d80e0730ccf4c5f23";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Fang -.-</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            <i class="menu-item-icon icon-next-commonweal"></i> <br />
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','http://7xltvd.com1.z0.glb.clouddn.com/swifty_st.js','_st');

  _st('install', '8paz1yFszaADHgDv8F_P','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/10/26/docker实践/" itemprop="url">
                docker实践
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-10-26T20:41:19+08:00" content="2016-10-26">
            2016-10-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/10/26/docker实践/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/26/docker实践/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Docker实践"><a href="#Docker实践" class="headerlink" title="Docker实践"></a>Docker实践</h1><blockquote>
<p>参考 <a href="https://yeasy.gitbooks.io/docker_practice/content/introduction/" target="_blank" rel="external">https://yeasy.gitbooks.io/docker_practice/content/introduction/</a></p>
</blockquote>
<h2 id="Docker介绍"><a href="#Docker介绍" class="headerlink" title="Docker介绍"></a>Docker介绍</h2><blockquote>
<p>Docker 是一个开源项目，诞生于 2013 年初，最初是 dotCloud 公司内部的一个业余项目。它基于 Google 公司推出的 Go 语言实现。 项目后来加入了 Linux 基金会，遵从了 Apache 2.0 协议，项目代码在 GitHub上进行维护。</p>
</blockquote>
<p>Docker 项目的目标是实现轻量级的操作系统虚拟化解决方案。 Docker 的基础是 Linux 容器（LXC）等技术。<br>在 LXC 的基础上 Docker 进行了进一步的封装，让用户不需要去关心容器的管理，使得操作更为简便。用户操作 Docker 的容器就像操作一个快速轻量级的虚拟机一样简单。<br>下面的图片比较了 Docker 和传统虚拟化方式的不同之处，可见容器是在操作系统层面上实现虚拟化，直接复用本地主机的操作系统，而传统方式则是在硬件层面实现。<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/virtualization.png" alt="Alt" title="virtual machines"><br><img src="http://7xltvd.com1.z0.glb.clouddn.com/docker.png" alt="Alt" title="docker"></p>
<h2 id="Docker的优势"><a href="#Docker的优势" class="headerlink" title="Docker的优势"></a>Docker的优势</h2><p>作为一种新兴的虚拟化方式，Docker 跟传统的虚拟化方式相比具有众多的优势。</p>
<p>首先，Docker 容器的启动可以在秒级实现，这相比传统的虚拟机方式要快得多。 其次，Docker 对系统资源的利用率很高，一台主机上可以同时运行数千个 Docker 容器。</p>
<p>容器除了运行其中应用外，基本不消耗额外的系统资源，使得应用的性能很高，同时系统的开销尽量小。传统虚拟机方式运行 10 个不同的应用就要起 10 个虚拟机，而Docker 只需要启动 10 个隔离的应用即可。</p>
<h3 id="我理解的Docker"><a href="#我理解的Docker" class="headerlink" title="我理解的Docker"></a>我理解的Docker</h3><p>目前，我在使用docker的过程中基本上是本地开发好项目之后，生成dist文件目录，迁移到docker当中，相当于只在生产环境开发使用docker，原因主要有以下几点：</p>
<ol>
<li>在开发环境使用docker感觉还是不是很舒服，每次修改都要重新build，以及run，比较麻烦，本地开发更加舒服；</li>
<li>docker实际上可以看做是一个封闭的盒子，想做一些查看和操作还是有点麻烦的的，交互性不是很好，感觉比较适合生产环境。</li>
</ol>
<h2 id="Docker-hub介绍"><a href="#Docker-hub介绍" class="headerlink" title="Docker hub介绍"></a>Docker hub介绍</h2><blockquote>
<p>目前 Docker 官方维护了一个公共仓库 Docker Hub，其中已经包括了超过 15,000 的镜像,大部分需求，都可以通过在 Docker Hub 中直接下载镜像来实现。</p>
</blockquote>
<h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><p>可以通过执行 docker login 命令来输入用户名、密码和邮箱来完成注册和登录。 注册成功后，本地用户目录的 .dockercfg 中将保存用户的认证信息。<br><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">docker</span> <span class="comment">login</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">username=username</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">email=email@gmail</span><span class="string">.</span><span class="comment">com</span></div></pre></td></tr></table></figure></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>根据是否是官方提供，可将镜像资源分为两类。 一种是类似 centos 这样的基础镜像，被称为基础或根镜像。这些基础镜像是由 Docker 公司创建、验证、支持、提供。这样的镜像往往使用单个单词作为名字。 还有一种类型，比如 tianon/centos 镜像，它是由 Docker 的用户创建并维护的，往往带有用户名称前缀。可以通过前缀 user_name/ 来指定使用某个用户提供的镜像，比如 tianon 用户。<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker pull apline</div><div class="line">// <span class="keyword">or</span></div><div class="line">docker pull mhart/alpine-<span class="keyword">node</span><span class="title">-auto</span></div></pre></td></tr></table></figure></p>
<h3 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h3><p>修改当前镜像之后需要提交修改后的镜像，修改一次镜像包括提交的过程如下：</p>
<p>先使用下载的镜像启动容器。<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker <span class="keyword">run</span><span class="bash"> -t -i training/sinatra /bin/bash</span></div><div class="line">root@<span class="number">0</span>b2616b0e5a8:/<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<p>注意：记住容器的 ID，稍后还会用到。<br>在容器中添加 json package(一个 ruby gem)。<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root<span class="variable">@0b2616b0e5a8</span><span class="symbol">:/</span><span class="comment"># gem install json</span></div></pre></td></tr></table></figure></p>
<p>当结束后，我们使用 exit 来退出，现在我们的容器已经被我们改变了，使用 docker commit 命令来提交更新后的副本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docker commit -m <span class="string">"Added json gem"</span> <span class="_">-a</span> <span class="string">"Docker Newbee"</span> 0b2616b0e5a8 ouruser/sinatra:v2</div><div class="line">4f177bd27a9ff0f6dc2a830403925b5360bfe0b93d476f7<span class="built_in">fc</span>3231110e7f71b1c</div></pre></td></tr></table></figure></p>
<p>其中，-m 来指定提交的说明信息，跟我们使用的版本控制工具一样；-a 可以指定更新的用户信息；之后是用来创建镜像的容器的 ID；最后指定目标镜像的仓库名和 tag 信息。创建成功后会返回这个镜像的 ID 信息。</p>
<p>使用 docker images 来查看新创建的镜像。</p>
<p>之后，可以使用新的镜像来启动容器<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="keyword">run</span><span class="bash"> -t -i ouruser/sinatra:v2 /bin/bash</span></div><div class="line">root@<span class="number">78</span>e82f680994:/<span class="comment">#</span></div></pre></td></tr></table></figure></p>
<h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p>用户可以通过 docker push 命令，把自己创建的镜像上传到仓库中来共享。例如，用户在 Docker Hub 上完成注册后，可以推送自己的镜像到仓库中。<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ docker push ouruser/sinatra</div><div class="line">The push refers <span class="keyword">to</span> <span class="keyword">a</span> repository [ouruser/sinatra] (<span class="built_in">len</span>: <span class="number">1</span>)</div><div class="line">Sending image <span class="keyword">list</span></div><div class="line">Pushing repository ouruser/sinatra (<span class="number">3</span> <span class="keyword">tags</span>)</div></pre></td></tr></table></figure></p>
<h3 id="修改镜像的标签"><a href="#修改镜像的标签" class="headerlink" title="修改镜像的标签"></a>修改镜像的标签</h3><p>用 docker tag 命令来修改镜像的标签。<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ sudo docker <span class="keyword">tag</span> <span class="title">5db5f8471261</span> ouruser/sinatra:devel</div><div class="line">$ sudo docker images ouruser/sinatra</div><div class="line">REPOSITORY          <span class="keyword">TAG</span>     <span class="title">IMAGE</span> ID      CREATED        VIRTUAL SIZE</div><div class="line">ouruser/sinatra     latest  <span class="number">5</span>db5f8471261  <span class="number">11</span> hours ago   <span class="number">446.7</span> MB</div><div class="line">ouruser/sinatra     devel   <span class="number">5</span>db5f8471261  <span class="number">11</span> hours ago   <span class="number">446.7</span> MB</div><div class="line">ouruser/sinatra     v2      <span class="number">5</span>db5f8471261  <span class="number">11</span> hours ago   <span class="number">446.7</span> MB</div></pre></td></tr></table></figure></p>
<h3 id="利用-Dockerfile-来创建镜像"><a href="#利用-Dockerfile-来创建镜像" class="headerlink" title="利用 Dockerfile 来创建镜像"></a>利用 Dockerfile 来创建镜像</h3><p>使用 docker commit 来扩展一个镜像比较简单，但是不方便在一个团队中分享。我们可以使用 docker build 来创建一个新的镜像。为此，首先需要创建一个 Dockerfile，包含一些如何创建镜像的指令。</p>
<p>Dockerfile 中每一条指令都创建镜像的一层，例如：<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Dockerfile.alpine</span></div><div class="line"><span class="keyword">FROM</span> mhart/alpine-node:latest</div><div class="line"><span class="keyword">MAINTAINER</span> zhanfang <span class="string">"fzhanxd@gmail.com"</span></div><div class="line"></div><div class="line"><span class="comment"># If you have native dependencies, you'll need extra tools</span></div><div class="line"><span class="comment"># RUN apk add --no-cache make gcc g++ python</span></div><div class="line"></div><div class="line"><span class="comment"># Create app directory</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /usr/src/app</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/src/app</span></div><div class="line"></div><div class="line"><span class="comment"># If your project depends on many package, you can use cnpm instead of npm</span></div><div class="line"><span class="comment"># RUN npm install cnpm -g --registry=https://registry.npm.taobao.org</span></div><div class="line"></div><div class="line"><span class="comment"># Install app dependencies</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> npm install --registry=https://registry.npm.taobao.org</span></div><div class="line"></div><div class="line"><span class="comment"># Bundle app source</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> . /usr/src/app</span></div><div class="line"></div><div class="line"><span class="comment"># Expose port</span></div><div class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></div><div class="line"></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">"npm"</span>, <span class="string">"start"</span> ]</span></div></pre></td></tr></table></figure></p>
<p>编写完成 Dockerfile 后可以使用 docker build 来生成镜像。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t alpine-koa2-startkit .</div></pre></td></tr></table></figure>
<p>其中 -t 标记来添加 tag，指定新的镜像的用户信息。 “.” 是 Dockerfile 所在的路径（当前目录），也可以替换为一个具体的 Dockerfile 的路径。</p>
<p>Dockfile 中的指令被一条一条的执行。每一步都创建了一个新的容器，在容器中执行指令并提交修改（就跟之前介绍过的 docker commit 一样）。当所有的指令都执行完毕之后，返回了最终的镜像 id。所有的中间步骤所产生的容器都被删除和清理了。</p>
<p><strong>注意一个镜像不能超过 127 层</strong></p>
<h2 id="完成一次镜像的下载、修改和上传"><a href="#完成一次镜像的下载、修改和上传" class="headerlink" title="完成一次镜像的下载、修改和上传"></a>完成一次镜像的下载、修改和上传</h2><p>以alpine-node-auto镜像为基础</p>
<ol>
<li><p>下载基础镜像</p>
 <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker pull mhart/alpine-<span class="keyword">node</span><span class="title">-auto</span></div></pre></td></tr></table></figure>
</li>
<li><p>编写dockerfile</p>
 <figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Dockerfile.alpine</span></div><div class="line"><span class="keyword">FROM</span> mhart/alpine-node:latest</div><div class="line"><span class="keyword">MAINTAINER</span> zhanfang <span class="string">"fzhanxd@gmail.com"</span></div><div class="line"></div><div class="line"><span class="comment"># If you have native dependencies, you'll need extra tools</span></div><div class="line"><span class="comment"># RUN apk add --no-cache make gcc g++ python</span></div><div class="line"></div><div class="line"><span class="comment"># Create app directory</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /usr/src/app</span></div><div class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/src/app</span></div><div class="line"></div><div class="line"><span class="comment"># If your project depends on many package, you can use cnpm instead of npm</span></div><div class="line"><span class="comment"># RUN npm install cnpm -g --registry=https://registry.npm.taobao.org</span></div><div class="line"></div><div class="line"><span class="comment"># Install app dependencies</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></div><div class="line"><span class="keyword">RUN</span><span class="bash"> npm install --registry=https://registry.npm.taobao.org</span></div><div class="line"></div><div class="line"><span class="comment"># Bundle app source</span></div><div class="line"><span class="keyword">COPY</span><span class="bash"> . /usr/src/app</span></div><div class="line"></div><div class="line"><span class="comment"># Expose port</span></div><div class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></div><div class="line"></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">"npm"</span>, <span class="string">"start"</span> ]</span></div></pre></td></tr></table></figure>
</li>
<li><p>创建新的镜像</p>
 <figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">docker</span> <span class="keyword">build </span>-t<span class="symbol">=zhanfang</span>/alpine-koa2-startkit:<span class="built_in">v1</span><span class="string">" .</span></div></pre></td></tr></table></figure>
<p> 打上 alpine-koa2-startkit:v1 的 tag</p>
</li>
<li><p>运行一个容器实例</p>
 <figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker <span class="built_in">run</span> -t -i <span class="comment">--name alpine-koa2-application zhanfang/alpine-koa2-startkit:v2</span></div></pre></td></tr></table></figure>
</li>
<li><p>上传镜像（如果没有登录请登陆，使用login命令）</p>
 <figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">docker</span> <span class="keyword">push </span>zhanfang/alpine-koa2-startkit</div></pre></td></tr></table></figure>
</li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/07/22/display属性详解/" itemprop="url">
                CSS display 属性详解
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-07-22T10:37:05+08:00" content="2016-07-22">
            2016-07-22
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/07/22/display属性详解/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/22/display属性详解/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>原文地址：<a href="http://zhanfang.github.io/2016/07/22/display属性详解" target="_blank" rel="external">http://zhanfang.github.io/2016/07/22/display属性详解</a> 转载请注明地址及作者: <code>zhanfang</code></p>
</blockquote>
<p>最近瞎忙了好长一段时间，一直没时间写文章，想深入学习一下css的相关属性，所以有了这篇文章，如有错误请指针。</p>
<h2 id="display的所有属性"><a href="#display的所有属性" class="headerlink" title="display的所有属性"></a>display的所有属性</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* CSS 1 */</span></div><div class="line"><span class="attribute">display</span>: none;</div><div class="line"><span class="attribute">display</span>: inline;</div><div class="line"><span class="attribute">display</span>: block;</div><div class="line"><span class="attribute">display</span>: list-item;</div><div class="line"></div><div class="line"><span class="comment">/* CSS 2.1 */</span></div><div class="line"><span class="attribute">display</span>: inline-block;</div><div class="line"></div><div class="line"><span class="attribute">display</span>: table;</div><div class="line"><span class="attribute">display</span>: inline-table;</div><div class="line"><span class="attribute">display</span>: table-cell;</div><div class="line"><span class="attribute">display</span>: table-column;</div><div class="line"><span class="attribute">display</span>: table-column-group;</div><div class="line"><span class="attribute">display</span>: table-footer-group;</div><div class="line"><span class="attribute">display</span>: table-header-group;</div><div class="line"><span class="attribute">display</span>: table-row;</div><div class="line"><span class="attribute">display</span>: table-row-group;</div><div class="line"><span class="attribute">display</span>: table-caption;</div><div class="line"><span class="comment">/* CSS 2.1 */</span></div><div class="line"></div><div class="line"><span class="comment">/* CSS 3 */</span></div><div class="line"><span class="attribute">display</span>: inline-list-item;</div><div class="line"><span class="attribute">display</span>: flex;</div><div class="line"><span class="attribute">display</span>: box;</div><div class="line"><span class="attribute">display</span>: inline-flex;</div><div class="line"></div><div class="line"><span class="attribute">display</span>: grid;</div><div class="line"><span class="attribute">display</span>: inline-grid;</div><div class="line"></div><div class="line"><span class="attribute">display</span>: ruby;</div><div class="line"><span class="attribute">display</span>: ruby-base;</div><div class="line"><span class="attribute">display</span>: ruby-text;</div><div class="line"><span class="attribute">display</span>: ruby-base-container;</div><div class="line"><span class="attribute">display</span>: ruby-text-container;</div><div class="line"><span class="comment">/* CSS 3 */</span></div><div class="line"></div><div class="line"><span class="comment">/* Experimental values */</span></div><div class="line"><span class="attribute">display</span>: contents;</div><div class="line"><span class="attribute">display</span>: run-in;</div><div class="line"><span class="comment">/* Experimental values */</span></div><div class="line"></div><div class="line"><span class="comment">/* Global values */</span></div><div class="line"><span class="attribute">display</span>: inherit;</div><div class="line"><span class="attribute">display</span>: initial;</div><div class="line"><span class="attribute">display</span>: unset;</div></pre></td></tr></table></figure>
<p>下面就display的重要属性进行讲解，并配合一些相关的例子</p>
<h2 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h2><h3 id="display-none"><a href="#display-none" class="headerlink" title="display: none"></a>display: none</h3><p>none 是 CSS 1 就提出来的属性，将元素设置为none的时候既不会占据空间，也无法显示，相当于该元素不存在。</p>
<p>该属性可以用来改善重排与重绘，同时我也经常用它来做模态窗等效果。</p>
<h3 id="display-inline"><a href="#display-inline" class="headerlink" title="display: inline"></a>display: inline</h3><p>inline也是 CSS 1 提出的属性，它主要用来设置行内元素属性，设置了该属性之后设置高度、宽度都无效，同时text-align属性设置也无效，但是设置了line-height会让inline元素居中</p>
<p><img src="http://7xltvd.com1.z0.glb.clouddn.com/display-none.png" alt="Alt"></p>
<p>同时从上图可以看到两个inline标签之间出现了奇怪的间隔，改间隔的原因是div换行产生的换行空白，解决办法</p>
<ul>
<li>将两个inline标签写到一行</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">&lt;<span class="regexp">/body&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>或者使用一点技巧</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>zhan<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"test"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">html&#123;</div><div class="line">  -webkit-text-size-adjust:none;/* 使用webkit的私有属性，让字体大小不受设备终端的调整，可定义字体大小小于12px */</div><div class="line">&#125;</div><div class="line">.main&#123;</div><div class="line">  font-size:0;</div><div class="line">  *word-spacing:-1px;/* 使用word-spacing 修复 IE6、7 中始终存在的 1px 空隙，减少单词间的空白（即字间隔） */</div><div class="line">&#125;</div><div class="line">.test&#123;</div><div class="line">  display:inline;</div><div class="line">  width: 10000px;</div><div class="line">  height:10000px;</div><div class="line">  border:1px solid;</div><div class="line">  font-size:12px;</div><div class="line"></div><div class="line">  letter-spacing: normal;/* 设置字母、字间距为0 */ </div><div class="line">  word-spacing: normal; /* 设置单词、字段间距为0 */</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实测chome49浏览器只用设置父元素的font-size为0即可。</p>
<blockquote>
<p>目前有很多原生的元素都是inline的，span、a、label、input、 img、 strong 和em就是典型的行内元素元素。<br>链接：<a href="http://www.css88.com/archives/646" target="_blank" rel="external">http://www.css88.com/archives/646</a></p>
</blockquote>
<h3 id="display-block"><a href="#display-block" class="headerlink" title="display: block"></a>display: block</h3><p>设置元素为块状元素，如果不指定宽高，默认会继承父元素的宽度，并且独占一行，即使宽度有剩余也会独占一行，高度一般以子元素撑开的高度为准，当然也可以自己设置宽度和高度。</p>
<blockquote>
<p>在设计的过程中有时需要设计一个div宽高都是整个屏幕，整个时候宽度很好设置，可是高度一般很难设置，因为页面一般都是可以滚动的，所以高度一般可变，所以这个时候可以使用一个小技巧，如下。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line">html&#123;</div><div class="line">  height: 100%;</div><div class="line">&#125;</div><div class="line">body&#123;</div><div class="line">  height: 100%;</div><div class="line">  padding: 0;</div><div class="line">  margin:0;</div><div class="line">&#125;</div><div class="line">.main&#123;</div><div class="line">  background: red;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>基本原理：div继承的是父元素body的高度，body是继承html的高度，html是继承的浏览器屏幕的高度。</p>
</blockquote>
<h3 id="display-list-item"><a href="#display-list-item" class="headerlink" title="display: list-item"></a>display: list-item</h3><p>此属性默认会把元素作为列表显示，要完全模仿列表的话还需要加上 <code>list-style-position</code>，<code>list-style-type</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>111111<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>222222<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>333333<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span>&#123;</div><div class="line">  <span class="attribute">padding-left</span>:<span class="number">30px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">span</span>&#123; </div><div class="line">  <span class="attribute">display</span>:list-item;</div><div class="line">  <span class="attribute">list-style</span>:disc outside none;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果图如下：<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/list-item.png" alt="Alt"></p>
<p>通过上面样式设置，就能仿出一个类似的列表，一定要在div上加padding，因为默认的列表之前的·在box外面</p>
<h3 id="display-inline-block"><a href="#display-inline-block" class="headerlink" title="display: inline-block"></a>display: inline-block</h3><p>inline-block为 CSS 2.1 新增的属性。 <strong>inline-block既具有block的宽高特性又具有inline的同行元素特性。</strong> 通过inline-block结合<code>text-align: justify</code> 还可以实现固定宽高的列表两端对齐布局，如下例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col1"</span>&gt;</span>111111<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col2"</span>&gt;</span>222222<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col3"</span>&gt;</span>333333<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col1"</span>&gt;</span>111111<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col2"</span>&gt;</span>222222<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col col3"</span>&gt;</span>333333<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col fix"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col fix"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col fix"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col fix"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col fix"</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">body</span>&#123;</div><div class="line">  <span class="attribute">margin</span>:<span class="number">0</span>;</div><div class="line">  <span class="attribute">padding</span>:<span class="number">0</span>; </div><div class="line">&#125;</div><div class="line"><span class="selector-class">.main</span>&#123;</div><div class="line">  <span class="attribute">text-align</span>:justify;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col</span>&#123; </div><div class="line">  <span class="attribute">display</span>: inline-block;</div><div class="line">  <span class="attribute">margin-top</span>:<span class="number">10px</span>;</div><div class="line">  <span class="attribute">width</span>:<span class="number">100px</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">  <span class="attribute">text-align</span>: center;</div><div class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col1</span>&#123;</div><div class="line">  <span class="attribute">background</span>: red;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col2</span>&#123;</div><div class="line">  <span class="attribute">background</span>: green;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col3</span>&#123;</div><div class="line">  <span class="attribute">background</span>: blue;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.fix</span>&#123;</div><div class="line">  <span class="attribute">height</span>:<span class="number">0</span>; </div><div class="line">  <span class="attribute">padding</span>:<span class="number">0</span>; </div><div class="line">  <span class="attribute">overflow</span>:hidden;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果图如下：<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/inline-block.png" alt="Alt"></p>
<blockquote>
<p><code>text-align: justify</code> 属性会使行内元素两端对齐，但是要求这些行内元素总宽度至少占满一行，所以在总宽度不足一行的时候这个属性没用，因此在最后需要加上一些占位符。</p>
</blockquote>
<p>详情可以查看 <a href="http://www.zhangxinxu.com/wordpress/2011/03/displayinline-blocktext-alignjustify%E4%B8%8B%E5%88%97%E8%A1%A8%E7%9A%84%E4%B8%A4%E7%AB%AF%E5%AF%B9%E9%BD%90%E5%B8%83%E5%B1%80/" target="_blank" rel="external">张鑫旭老师的博客</a></p>
<p><strong>Tip: inline-block会形成一个BFC</strong></p>
<h3 id="display-table"><a href="#display-table" class="headerlink" title="display: table"></a>display: table</h3><p>table 此元素会作为块级表格来显示（类似table），表格前后带有换行符。CSS表格能够解决所有那些我们在使用绝对定位和浮动定位进行多列布局时所遇到的问题。例如，<code>display:table</code>的CSS声明能够让一个HTML元素和它的子节点像table元素一样。使用基于表格的CSS布局，使我们能够轻松定义一个单元格的边界、背景等样式， <strong>而不会产生因为使用了table那样的制表标签所导致的语义化问题。</strong></p>
<p>利用table的特性，我们能够轻易的实现三栏布局，并且能够兼容IE8，如下是使用table属性，实现三栏布局的例子：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tr tr1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>head1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>head2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>head3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tr tr2"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"td"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.main</span>&#123;</div><div class="line">  <span class="attribute">display</span>: table;</div><div class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</div><div class="line">  <span class="attribute">border-collapse</span>: collapse;<span class="comment">/*为表格设置合并边框模型：*/</span></div><div class="line">&#125;</div><div class="line"><span class="selector-class">.tr</span>&#123;</div><div class="line">  <span class="attribute">display</span>: table-row;</div><div class="line">  <span class="attribute">border-color</span>: inherit;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.tr1</span> <span class="selector-class">.td</span>&#123;</div><div class="line">  <span class="attribute">height</span>:<span class="number">50px</span>;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.td</span>&#123;</div><div class="line">  <span class="attribute">display</span>: table-cell;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.td</span><span class="selector-pseudo">:nth-of-type(1)</span>&#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.td</span><span class="selector-pseudo">:nth-of-type(3)</span>&#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下图：<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/display-table.png" alt="Alt"></p>
<blockquote>
<p>CSS2.1表格模型中的元素，可能不会全部包含在除HTML之外的文档语言中。这时，那些“丢失”的元素会被模拟出来，从而使得表格模型能够正常工作。所有的表格元素将会自动在自身周围生成所需的匿名table对象，使其符合table/inline-table、table-row、table-cell的三层嵌套关系。</p>
</blockquote>
<p>所以在一般情况下我们也可以不写外面的table-row元素以及table元素。</p>
<h3 id="display-inline-list-item"><a href="#display-inline-list-item" class="headerlink" title="display: inline-list-item"></a>display: inline-list-item</h3><p>我在MDN上面看到有这个属性，但是我实际尝试发现这个属性是不能使用的，在 <a href="http://caniuse.com/#search=inline-list-item" target="_blank" rel="external">http://caniuse.com/#search=inline-list-item</a> 上面也没有找到这个元素的兼容性，所以应该是不能使用的，支持度全无。</p>
<h3 id="display-flex"><a href="#display-flex" class="headerlink" title="display: flex"></a>display: flex</h3><p>flex是一种弹性布局属性<br><strong>注意，设为Flex布局以后，子元素的float、clear和vertical-align属性将失效。</strong><br>主要属性有两大类：容器属性和项目的属性</p>
<h4 id="容器属性"><a href="#容器属性" class="headerlink" title="容器属性"></a>容器属性</h4><ul>
<li>flex-direction: 属性决定主轴的方向（即项目的排列方向）。</li>
<li>flex-wrap: 默认情况下，项目都排在一条线（又称”轴线”）上。flex-wrap属性定义，如果一条轴线排不下，如何换行。</li>
<li>flex-flow: 属性是flex-direction属性和flex-wrap属性的简写形式，默认值为row nowrap。</li>
<li>justify-content: 属性定义了项目在主轴上的对齐方式。</li>
<li>align-items: 属性定义项目在交叉轴上如何对齐。</li>
<li>align-content: 属性定义了多根轴线的对齐方式。如果项目只有一根轴线，该属性不起作用。</li>
</ul>
<h4 id="项目属性"><a href="#项目属性" class="headerlink" title="项目属性"></a>项目属性</h4><ul>
<li>order: 定义项目的排列顺序。数值越小，排列越靠前，默认为0。</li>
<li>flex-grow: 定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大。</li>
<li>flex-shrink: 属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。</li>
<li>flex-basis: 属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为auto，即项目的本来大小。</li>
<li>flex: 属性是flex-grow, flex-shrink 和 flex-basis的简写，默认值为0 1 auto。后两个属性可选。</li>
<li>align-self: 属性允许单个项目有与其他项目不一样的对齐方式，可覆盖align-items属性。默认值为auto，表示继承父元素的align-items属性，如果没有父元素，则等同于stretch。</li>
</ul>
<p>以上关于flex的基础知识基本是从阮一峰老师那copy过来的，有兴趣的同学，可以到阮一峰老师的博客深入阅读</p>
<p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html</a><br><a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2015/07/flex-examples.html</a></p>
<h4 id="实例：实现一个固定宽度但内容可变的列表"><a href="#实例：实现一个固定宽度但内容可变的列表" class="headerlink" title="实例：实现一个固定宽度但内容可变的列表"></a>实例：实现一个固定宽度但内容可变的列表</h4><p>目前我有一个需求，有一个列表页，左侧固定，右侧固定，总宽度固定，但是左侧的内容可能会增加，右侧的内容也可能会增加，要求平时一行展示，增加的时候两行展示，左侧两行，右侧还是一行，并且都居中。</p>
<p>先上效果图，不然可能会迷糊：<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/flex.png" alt="Alt"></p>
<p>为了实现上述效果，代码如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"col1"</span>&gt;</span>累积的分为：123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col2"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>x 10<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"col1"</span>&gt;</span>累积的分为：1234<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col2"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://7xltvd.com1.z0.glb.clouddn.com/css1.png"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"col2-span"</span>&gt;</span>x 10<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">button</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.main</span>&#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">ul</span>&#123;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">0px</span>;</div><div class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">li</span>&#123;</div><div class="line">  <span class="attribute">display</span>: flex;</div><div class="line">  <span class="attribute">justify-content</span>: space-between;</div><div class="line">  <span class="attribute">align-items</span>: center;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</div><div class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">button</span>&#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">  <span class="attribute">border</span>:<span class="number">0</span>;</div><div class="line">  <span class="attribute">background</span>: green;</div><div class="line">  <span class="attribute">outline</span>:none;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">img</span>&#123;</div><div class="line">  <span class="attribute">width</span>:<span class="number">30px</span>;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col2-span</span>&#123;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col1</span>&#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">130px</span>;</div><div class="line">  <span class="attribute">padding-left</span>:<span class="number">8px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.col2</span>&#123;</div><div class="line">  <span class="attribute">padding-right</span>: <span class="number">8px</span>;</div><div class="line">  <span class="attribute">vertical-align</span>: middle;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="display-webkit-box"><a href="#display-webkit-box" class="headerlink" title="display: -webkit-box"></a>display: -webkit-box</h4><p>由于某X5浏览器某些版本还不支持最新版的flex布局，所以为了保证良好的运行，建议还是使用<code>display: box</code>，box和flex布局的主要差别如下:</p>
<h5 id="容器属性-1"><a href="#容器属性-1" class="headerlink" title="容器属性"></a>容器属性</h5><ul>
<li>display: box<br>该显示样式的新值可将此元素及其直系子代加入弹性框模型中。Flexbox 模型只适用于直系子代。</li>
<li>box-orient<br>值：horizontal | vertical | inherit<br>框的子代是如何排列的？还有两个值：inline-axis（真正的默认值）和 block-axis，但是它们分别映射到水平和垂直方向。</li>
<li>box-pack<br>值：start | end | center | justify<br>设置沿 box-orient 轴的框排列方式。因此，如果 box-orient 是水平方向，就会选择框的子代的水平排列方式，反之亦然。</li>
<li>box-align<br>值：start | end | center | baseline | stretch<br>基本上而言是 box-pack 的同级属性。设置框的子代在框中的排列方式。如果方向是水平的，该属性就会决定垂直排列，反之亦然。</li>
</ul>
<h5 id="项目属性-1"><a href="#项目属性-1" class="headerlink" title="项目属性"></a>项目属性</h5><ul>
<li>box-flex<br>值：0 | 任意整数<br>该子代的弹性比。弹性比为 1 的子代占据父代框的空间是弹性比为 2 的同级属性的两倍。其默认值为 0，也就是不具有弹性。</li>
</ul>
<h5 id="用box改造上述例子"><a href="#用box改造上述例子" class="headerlink" title="用box改造上述例子"></a>用box改造上述例子</h5><p>基本只修改了容器元素li的属性，如下所示</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">li</span>&#123;</div><div class="line">  <span class="attribute">display</span>: -webkit-box;</div><div class="line">  <span class="attribute">-webkit-box-orient</span>:horizontal;</div><div class="line">  <span class="attribute">-webkit-box-pack</span>: justify;</div><div class="line">  <span class="attribute">-webkit-box-align</span>: center;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</div><div class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="display-inline-flex"><a href="#display-inline-flex" class="headerlink" title="display: inline-flex"></a>display: inline-flex</h3><p>我发现在chrome条件下设置了inline-flex，其子元素全部变成了inline模式，设置flex并没有什么用，不知道是不是我写的有问题，目前没找到这个属性的用法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS Bin<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sp1"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sp1"</span>&gt;</span>123<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.main</span>&#123;</div><div class="line">  <span class="attribute">display</span>: -webkit-inline-flex;</div><div class="line">  <span class="attribute">justify-content</span>: center;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.sp1</span>&#123;</div><div class="line">  <span class="attribute">flex</span>:<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>以下属性是实验性质的，支持度都很低，不建议使用，知道就行。</p>
<ul>
<li>run-in: 此元素会根据上下文作为块级元素或内联元素显示；</li>
<li>grid: 栅格模型，类似block</li>
<li>inline-grid: 栅格模型，类似inline-block</li>
<li>ruby, ruby-base, ruby-text, ruby-base-container, ruby-text-container</li>
<li>contents</li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/05/27/react-vue权限管理/" itemprop="url">
                react/vue单页权限管理思路
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-05-27T22:19:49+08:00" content="2016-05-27">
            2016-05-27
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/05/27/react-vue权限管理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/27/react-vue权限管理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近一直在做react和vue方面的研究，发现这两种解决方案所解决的问题基本是相似的：</p>
<ul>
<li>组件化：将页面分成很多组件进行编写，这样可复用性好，而且逻辑清晰，肯定是趋势</li>
<li>路由管理：react有react-router，vue有vue-router，基本都是解决前端路由的问题，当然react拥有后台渲染的能力，所以可以前后端共享一套路由，这个比较爽，vue2即将也要推出服务器渲染了，值得期待</li>
<li>数据管理：这块基本就是redux和vuex，这两个基本一致</li>
</ul>
<p>但是我在做页面的时候还有一个问题怎么也绕不过去：<strong>权限管理怎么处理？</strong></p>
<blockquote>
<p>简单点说就是在用户登录和未登录时，展示的页面是不同的，有些页面可以访问，有些不能，需要做页面间的跳转。</p>
</blockquote>
<p>下面就以vue为例子介绍我在权限管理方面做的尝试</p>
<p>另附上我使用vue-cli作为基础构建工具，结合markdown插件做的带登录、注册、在线保存功能的todolist，访问地址 <a href="http://vue.demozhan.com" target="_blank" rel="external">http://vue.demozhan.com</a></p>
<h2 id="权限管理以往解决办法"><a href="#权限管理以往解决办法" class="headerlink" title="权限管理以往解决办法"></a>权限管理以往解决办法</h2><p>在以往的处理办法中，我一般使用的是服务器存储session，客户端存储cookie，当页面访问的时候会携带带有服务器sessionid的cookie信息，通过查询session做处理，已经登录的用户自动跳转，未登录的用户会跳转到登录页面。</p>
<p>上面这种方法适用于传统的网页跳转类型的网站，路由的相关处理其实是在服务器端，但对于单页网站，路由在前端处理的就不太合适了，因为前端页面的跳转是通过前端路由来完成的，特别是vue我发现，在地址栏输入url是完全被前端路由拦截了，根本不会向后台发送请求，react还是会发请求的（个人理解，如有不正确的地方请指出），所以无法通过携带cookie方式进行重定向来做权限管理。</p>
<h2 id="vue解决前端路由的几种方式"><a href="#vue解决前端路由的几种方式" class="headerlink" title="vue解决前端路由的几种方式"></a>vue解决前端路由的几种方式</h2><h3 id="vuex-root状态树中保存登陆信息"><a href="#vuex-root状态树中保存登陆信息" class="headerlink" title="vuex root状态树中保存登陆信息"></a>vuex root状态树中保存登陆信息</h3><p>有一种解决思路，在vuex存储登陆/认证信息，一旦登陆了state中就保留了登陆的信息。</p>
<p>但是这个方案存在一个问题，当用户刷新页面的时候状态树会被重置，用户登录的信息就不存在了。</p>
<h3 id="异步查询状态方法"><a href="#异步查询状态方法" class="headerlink" title="异步查询状态方法"></a>异步查询状态方法</h3><p>目前vue-cli-note解决权限管理的方法是通过异步查询状态的方法，即在页面初始化的时候会异步发送请求给服务器判断是否登录，目前的确可以解决权限的问题。</p>
<p>但这个方案也存在一个问题，页面需要发送很多不必要的http请求，我觉得这个方案不够优雅。</p>
<h3 id="使用localstorage-cookie存储状态"><a href="#使用localstorage-cookie存储状态" class="headerlink" title="使用localstorage/cookie存储状态"></a>使用localstorage/cookie存储状态</h3></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/04/18/koa中webpack热加载-NODE-ENV配置/" itemprop="url">
                koa中webpack热加载&&NODE_ENV配置
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-04-18T14:00:15+08:00" content="2016-04-18">
            2016-04-18
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/04/18/koa中webpack热加载-NODE-ENV配置/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/18/koa中webpack热加载-NODE-ENV配置/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>目前在用koa+react+redux搭建一个微信后台，需要用到webpack热加载的方式方便进行开发，同时参考redux官方例子的配置方式，发现<code>process.env.NODE_ENV</code>一直是undefined，所以有了这篇文章。</p>
</blockquote>
<p>本文主要介绍express以及koa中webpack热加载的实现方式，同时解决<code>process.env.NODE_ENV</code>传递的问题。</p>
<h2 id="express热加载"><a href="#express热加载" class="headerlink" title="express热加载"></a>express热加载</h2><p>通过引入webpack热加载的中间件即可，如下所示</p>
<p>server.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</div><div class="line"><span class="keyword">var</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</div><div class="line"><span class="keyword">var</span> webpackHotMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-hot-middleware'</span>)</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>)</div><div class="line"><span class="keyword">var</span> compiler = webpack(config)</div><div class="line">app.use(webpackDevMiddleware(compiler, &#123;</div><div class="line">  <span class="attr">noInfo</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">publicPath</span>: config.output.publicPath</div><div class="line">&#125;))</div><div class="line">app.use(webpackHotMiddleware(compiler))</div></pre></td></tr></table></figure></p>
<p>在<code>webpack.config.js</code>中引入热加载插件，添加entry入口，以及publicPath<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">devtool</span>: <span class="string">'cheap-module-eval-source-map'</span>,</div><div class="line">  <span class="attr">entry</span>: [</div><div class="line">    <span class="string">'webpack-hot-middleware/client'</span>,</div><div class="line">    <span class="string">'./index'</span></div><div class="line">  ],</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">'dist'</span>),</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'/static/'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">plugins</span>: [</div><div class="line">    <span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</div><div class="line">  ],</div><div class="line">  <span class="attr">module</span>: &#123;</div><div class="line">    <span class="attr">loaders</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">        <span class="attr">loaders</span>: [ <span class="string">'babel'</span> ],</div><div class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">        <span class="attr">include</span>: __dirname</div><div class="line">      &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>完成以上文件的修改即可实现启动node服务器实现热加载</p>
<h2 id="koa中实现热加载"><a href="#koa中实现热加载" class="headerlink" title="koa中实现热加载"></a>koa中实现热加载</h2><blockquote>
<p>在koa中如果直接使用express的加载方式，会造成每次触发请求以及返回请求都会重新打包。</p>
</blockquote>
<p>解决办法：直接使用<code>koa-webpack-dev-middleware</code>以及<code>koa-webpack-dev-middleware</code>，当然阅读这两个中间件源码可以发现它们的加载方式实际上还是和express差不多，只是在执行中间件的时候就已经完成了热加载的过程，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> expressMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">middleware</span>(<span class="params">doIt, req, res</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> originalEnd = res.end;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</div><div class="line">    res.end = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      originalEnd.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">      done(<span class="literal">null</span>, <span class="number">0</span>);</div><div class="line">    &#125;;</div><div class="line">    doIt(req, res, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      done(<span class="literal">null</span>, <span class="number">1</span>);</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">compiler, option</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> doIt = expressMiddleware(compiler, option);</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>*(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ctx = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">var</span> req = <span class="keyword">this</span>.req;</div><div class="line">    <span class="keyword">var</span> runNext = <span class="keyword">yield</span> middleware(doIt, req, &#123;</div><div class="line">      <span class="attr">end</span>: <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;</div><div class="line">        ctx.body = content;</div><div class="line">      &#125;,</div><div class="line">      <span class="attr">setHeader</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        ctx.set.apply(ctx, <span class="built_in">arguments</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">if</span> (runNext) &#123;</div><div class="line">      <span class="keyword">yield</span> *next;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在koa中的使用方式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"><span class="keyword">var</span> webpackDevMiddleware = <span class="built_in">require</span>(<span class="string">'koa-webpack-dev-middleware'</span>);</div><div class="line"><span class="keyword">var</span> webpackHotMiddleware = <span class="built_in">require</span>(<span class="string">'koa-webpack-hot-middleware'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>)</div><div class="line"><span class="keyword">var</span> compiler = webpack(config);</div><div class="line">app.use(webpackDevMiddleware(compiler, &#123;</div><div class="line">  <span class="attr">noInfo</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">publicPath</span>: config.output.publicPath</div><div class="line">&#125;));</div><div class="line">app.use(webpackHotMiddleware(compiler));</div></pre></td></tr></table></figure></p>
<h2 id="react中-process-env-NODE-ENV-undefined"><a href="#react中-process-env-NODE-ENV-undefined" class="headerlink" title="react中 process.env.NODE_ENV undefined"></a>react中 <code>process.env.NODE_ENV</code> undefined</h2><blockquote>
<p>这个问题实际上是因为react或者前端本省并不可能获取到<code>process.env.NODE_ENV</code>，只能通过后台传递参数到前端才可以。</p>
</blockquote>
<p>解决方法：在webpack中有一个插件可以解决这个问题</p>
<p>webpack.config.js(列出部分代码)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> env = process.env.NODE_ENV;</div><div class="line"><span class="keyword">var</span> config = &#123;</div><div class="line">  <span class="attr">plugins</span>: [</div><div class="line">    <span class="keyword">new</span> webpack.optimize.OccurenceOrderPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.NoErrorsPlugin(),</div><div class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</div><div class="line">      <span class="string">'process.env.NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(env)</div><div class="line">    &#125;)</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/04/13/redux中reducer与action的绑定/" itemprop="url">
                redux中reducer与action的绑定
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-04-13T22:22:04+08:00" content="2016-04-13">
            2016-04-13
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/04/13/redux中reducer与action的绑定/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/13/redux中reducer与action的绑定/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>这两天在学习redux，一直比较困惑在在dispatch action的时候是如何触发reducer的状态转移的，所以今晚好好研究了一下</p>
</blockquote>
<h2 id="redux管理状态"><a href="#redux管理状态" class="headerlink" title="redux管理状态"></a>redux管理状态</h2><p><img src="http://7xltvd.com1.z0.glb.clouddn.com/redux-action.png" alt="Alt" title="redux"><br>整个状态树store是通过createStore创建的createStore方法接收<strong>reducer函数</strong>和<strong>初始化的数据(currentState)</strong>，并将这2个参数并保存在store中。</p>
<h2 id="action和reducer的绑定"><a href="#action和reducer的绑定" class="headerlink" title="action和reducer的绑定"></a>action和reducer的绑定</h2><p>在redux中触发状态转移一般是通过</p>
<pre><code>dispatch(action(text));
</code></pre><p>或者</p>
<pre><code>actions.action(text);
</code></pre><p>但是在action()中并没有指定redux，所以action是怎么调用redux状态转移的呢？</p>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>实际上reducer函数的名字并没有什么用，只是为了指定子reducer的名字，便于生成rootReducer的时候使用，以及生成初始的state。</p>
<p><strong>而action与reducer之间的绑定是通过action.type来实现的，同时不同的reducer只要带有相同 type 属性的都会执行。</strong></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> todoApp <span class="keyword">from</span> <span class="string">'./todos'</span>;</div><div class="line"><span class="keyword">import</span> &#123; ADD_TODO &#125; <span class="keyword">from</span> <span class="string">'../constants/ActionTypes'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> initilState = [</div><div class="line">  &#123;</div><div class="line">    <span class="attr">text</span>: <span class="string">'Use Redux'</span>,</div><div class="line">    <span class="attr">completed</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">id</span>: <span class="number">0</span></div><div class="line">  &#125;</div><div class="line">];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">state = initilState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> ADD_TODO:</div><div class="line">      <span class="keyword">let</span> id = state.reduce(<span class="function">(<span class="params">maxId, currTodo</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.max(currTodo.id, maxId);</div><div class="line">      &#125;, <span class="number">-1</span>) + <span class="number">1</span>;</div><div class="line">      <span class="keyword">return</span> [</div><div class="line">        &#123;</div><div class="line">          <span class="attr">text</span>: action.text,</div><div class="line">          <span class="attr">completed</span>: <span class="literal">true</span>,</div><div class="line">          <span class="attr">id</span>: id</div><div class="line">        &#125;,</div><div class="line">        ...state</div><div class="line">      ];</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</div><div class="line">  todoApp,</div><div class="line">  test</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</div></pre></td></tr></table></figure>
<p>上面例子中定义了一个todoApp的reducer，并且添加了一个test的reducer，都有相同的action.type为<code>ADD_TODO</code>。</p>
<p>最后调试发现产生了两个storeState，并且<code>case ADD_TODO</code>都执行了。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>今天在做异步请求数据的时候发现几个redux的小技巧</p>
<h3 id="reducer中利用相同的action-type进行处理"><a href="#reducer中利用相同的action-type进行处理" class="headerlink" title="reducer中利用相同的action.type进行处理"></a>reducer中利用相同的action.type进行处理</h3><blockquote>
<p>由于相同的action.type都会在触发action的时候执行，因此可以利用action.type做类似分支的效果，见如下代码</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> initPosts = &#123;</div><div class="line">  <span class="attr">isFetching</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">didInvalidate</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">items</span>: []</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params">state = initPosts, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> RECEIVE_POSTS:</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        <span class="attr">isFetching</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">didInvalidate</span>: <span class="literal">false</span>,</div><div class="line">        <span class="attr">items</span>: action.posts,</div><div class="line">        <span class="attr">lastUpdated</span>: action.receivedAt</div><div class="line">      &#125;)</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">postsByReddit</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> RECEIVE_POSTS:</div><div class="line">    <span class="keyword">case</span> REQUEST_POSTS:</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        [action.reddit]: posts(state[action.reddit], action)</div><div class="line">      &#125;)</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</div><div class="line">  selectedReddit,</div><div class="line">  postsByReddit,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="需要进行状态的改变可以利用componentWillReceiveProps"><a href="#需要进行状态的改变可以利用componentWillReceiveProps" class="headerlink" title="需要进行状态的改变可以利用componentWillReceiveProps"></a>需要进行状态的改变可以利用componentWillReceiveProps</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">componentWillReceiveProps(nextProps) &#123;</div><div class="line">  <span class="keyword">if</span> (nextProps.selectedReddit !== <span class="keyword">this</span>.props.selectedReddit) &#123;</div><div class="line">    <span class="keyword">const</span> &#123;selectedReddit, actions&#125; = nextProps;</div><div class="line">    actions.fetchPosts(selectedReddit);   </div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/04/11/react服务器渲染及路由同步/" itemprop="url">
                react服务器渲染及路由同步
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-04-11T17:19:33+08:00" content="2016-04-11">
            2016-04-11
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/04/11/react服务器渲染及路由同步/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/11/react服务器渲染及路由同步/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>首先说明我最后还是没有使用react服务器渲染，一方面是因为我突然发现我不怎么需要服务器渲染，另一方面遇到的坑太多了，而且大多解决方法都是不断的重新安装依赖包，心太累了。</p>
</blockquote>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>目前我正在做的东西，后台已经用koa搭建好了，可是前端我想折腾一下就作死的用react，已经ant-design尝试了一下，单做前台页面还是ok的，但是一旦和后台一起就有很多问题。</p>
<ol>
<li>路由同步怎么解决；</li>
<li>服务器渲染怎么解决；</li>
<li>reflux状态管理怎么实现；</li>
</ol>
<p>本文只讲一下第一个和第二个问题，对于服务器渲染其实还有很多讲究，哪些内容需要服务器渲染，哪些不需要（首屏服务器渲染，次屏客户端渲染），怎么实现，这些问题研究下去实在太深了，我要消化消化，此外本文主要讲解实现上的东西，原理我好多也没弄明白。</p>
<h2 id="路由同步-服务器渲染"><a href="#路由同步-服务器渲染" class="headerlink" title="路由同步+服务器渲染"></a>路由同步+服务器渲染</h2><p>引入node中加载react的依赖<br>package.json<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line"><span class="string">"babel-preset-react"</span>: <span class="string">"^6.1.18"</span>,</div><div class="line"><span class="string">"babel-register"</span>: <span class="string">"^6.3.13"</span>,</div></pre></td></tr></table></figure></p>
<p>server.js中加载es6和react的相关依赖<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>)(&#123;</div><div class="line">  <span class="attr">presets</span>: [<span class="string">'es2015'</span>, <span class="string">'react'</span>]</div><div class="line">&#125;);</div><div class="line"><span class="comment">//---------react服务器渲染及路由匹配----------</span></div><div class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>);</div><div class="line"><span class="keyword">var</span> ReactDOM = <span class="built_in">require</span>(<span class="string">'react-dom/server'</span>);</div><div class="line"><span class="keyword">var</span> ReactRouter = <span class="built_in">require</span>(<span class="string">'react-router'</span>);</div><div class="line"><span class="keyword">var</span> reactR = <span class="built_in">require</span>(<span class="string">'./app/routes'</span>);</div><div class="line"><span class="keyword">var</span> swig = <span class="built_in">require</span>(<span class="string">'swig'</span>);</div><div class="line"><span class="comment">//-----------------------------------------</span></div></pre></td></tr></table></figure></p>
<p>编写koa中间件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">app.use(<span class="function"><span class="keyword">function</span>*(<span class="params">next</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">  debug(<span class="string">'self.path is %s'</span>, self.path);</div><div class="line">  ReactRouter.match(&#123;</div><div class="line">    <span class="attr">routes</span>: reactR.default,</div><div class="line">    <span class="attr">location</span>: self.path</div><div class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, redirectLocation, renderProps</span>) </span>&#123;</div><div class="line">    debug(<span class="string">'redirectLocation is %s'</span>, redirectLocation);</div><div class="line">    debug(<span class="string">'err is %s'</span>, err);</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      self.status = <span class="number">500</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (redirectLocation) &#123;</div><div class="line">      self.redirect(redirectLocation.pathname + redirectLocation.search)</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (renderProps) &#123;</div><div class="line">      <span class="keyword">var</span> html = ReactDOM.renderToString(React.createElement(ReactRouter.RouterContext, renderProps));</div><div class="line">      debug(<span class="string">'html page is %s'</span>, html);</div><div class="line">      <span class="keyword">var</span> page = swig.renderFile(<span class="string">'views/index.html'</span>, &#123;</div><div class="line">         <span class="attr">html</span>: html</div><div class="line">       &#125;);</div><div class="line">      self.body = swig.renderFile(<span class="string">'views/index.html'</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      self.status = <span class="number">404</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">yield</span> next;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/31/cookie-session-fetch/" itemprop="url">
                cookie-session-fetch
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-31T15:30:19+08:00" content="2016-03-31">
            2016-03-31
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/03/31/cookie-session-fetch/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/31/cookie-session-fetch/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近一定是太“闲”了，遇到一个问题非要深究下去，最近在做koa-weixin的时候遇到几个问题，当然也是因为之前学习不够深入造成的；</p>
<ol>
<li>默认使用<code>koa-generic-session</code>和<code>koa-redis</code>配合使用完成session机制，可是存在一个问题，默认cookie保存时间为一天，我认为关闭浏览器cookie就会被销毁，结果第二天打开网站发现能够登陆；</li>
<li>修改cookie保存时间可行，但是却始终无法使得关闭浏览器cookie失效；</li>
<li>使用fetch异步发送数据，无法发送cookie；</li>
</ol>
<h2 id="cookie及session原理"><a href="#cookie及session原理" class="headerlink" title="cookie及session原理"></a>cookie及session原理</h2><blockquote>
<p>保持一个会话的方式是利用session存储在服务器，常见的存储方式是存储在内存、文件、redis和数据库，不管使用哪种方式，都需要产生一个session，并将session id存储到cookie，通过将cookie发送给客户端来保持连接，在每次客户端发送请求的时候，都会带上cookie的相关信息，其中就包括session id，在服务器端通过session id来查询session的相关信息</p>
</blockquote>
<p><strong>下面内容转载自 <a href="http://www.cnblogs.com/fnng/archive/2012/08/14/2637279.html" target="_blank" rel="external">虫师</a> :</strong></p>
<h3 id="Cookie-与session的产生过程"><a href="#Cookie-与session的产生过程" class="headerlink" title="Cookie 与session的产生过程"></a>Cookie 与session的产生过程</h3><p>我们都知道HTTP协议本身是无状态的，客户只需要简单的向服务器来发送请求下载某些文件，客户端向服务器端发送的每次请求都是独立的。对于当前的web应用，HTTP的“无状态”，导致许多应用都不得不花费大量的精力来记录用户的操作步骤。就像我们上面介绍的第一种情况，银行职员要花费大量的精力来记忆每一位用户的存/取款记录。</p>
<p>程序员很快发现，如果能够提供一些按需生成的动太信息，会使web的交互能力大大增强。程序员一方面在HTML中添加表单、脚本、DOM等客户端行为，来增加web应用与客户端的交互性。另一方面在服务器端测出现了CGI规范以响应客户端的动态请求，作为传输载体的HTTP协议添加了文件上载、cookie 等特性。那cookie的原理与我们上面介绍的使用存折记录用户应为的方式是一样一样的。</p>
<p>通过前面的例子我们已经发现，通过cookie的方式存储信息，可能会存在一点定的安全性，因为所有的信息都是写在客户端的，客户可能会对这些信息进行修改或清除。然后就又出现session的方式用于保存用户行为，这种方式的原理与前面介绍银行卡的方式是一样的。</p>
<p>具体来说cookie机制采用的是在客户端保持状态的方案，而session机制采用的是在服务器端保持状态的方案。同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，所以session机制可能需要借助于cookie机制来达到保存标识的目的，但实际上它还有其他选择。</p>
<h3 id="cookie机制。"><a href="#cookie机制。" class="headerlink" title="cookie机制。"></a>cookie机制。</h3><p>正统的cookie分发是通过扩展HTTP协议来实现的，服务器通过在HTTP的响应头中加上一行特殊的指示以提示浏览器按照指示生成相应的cookie。然而纯粹的客户端脚本如JavaScript或者VBScript也可以生成cookie。而cookie的使用是由浏览器按照一定的原则在后台自动发送给服务器的。浏览器检查所有存储的cookie，如果某个cookie所声明的作用范围大于等于将要请求的资源所在的位置，则把该cookie附在请求资源的HTTP请求头上发送给服务器。</p>
<p>cookie的内容主要包括：名字，值，过期时间，路径和域。路径与域一起构成cookie的作用范围。若不设置过期时间，则表示这个cookie的生命期为浏览器会话期间，关闭浏览器窗口，cookie就消失。这种生命期为浏览器会话期的cookie被称为会话cookie。会话cookie一般不存储在硬盘上而是保存在内存里，当然这种行为并不是规范规定的。若设置了过期时间，浏览器就会把cookie保存到硬盘上，关闭后再次打开浏览器，这些cookie仍然有效直到超过设定的过期时间。存储在硬盘上的cookie可以在不同的浏览器进程间共享，比如两个IE窗口。而对于保存在内存里的cookie，不同的浏览器有不同的处理方式。 </p>
<h3 id="session机制"><a href="#session机制" class="headerlink" title="session机制"></a>session机制</h3><p>session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。 </p>
<p>当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session标识————称为session id，如果已包含则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（检索不到，会新建一个），如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。</p>
<p>保存这个session id的方式可以采用cookie，这样在交互过程中浏览器可以自动的按照规则把这个标识发挥给服务器。一般这个cookie的名字都是类似于SEEESIONID。但cookie可以被人为的禁止，则必须有其他机制以便在cookie被禁止时仍然能够把session id传递回服务器。</p>
<p>经常被使用的一种技术叫做URL重写，就是把session id直接附加在URL路径的后面。还有一种技术叫做表单隐藏字段。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把session id传递回服务器。</p>
<h3 id="Jsessionid"><a href="#Jsessionid" class="headerlink" title="Jsessionid"></a>Jsessionid</h3><p>Jsessionid只是tomcat的对sessionid的叫法，其实就是sessionid；在其它的容器也许就不叫jsessionid了。</p>
<h2 id="关闭浏览器cookie清除"><a href="#关闭浏览器cookie清除" class="headerlink" title="关闭浏览器cookie清除"></a>关闭浏览器cookie清除</h2><p>cookie 参数: </p>
<ul>
<li>path：表示 cookie 影响到的路径，匹配该路径才发送这个 cookie。</li>
<li>expires 和 maxAge：告诉浏览器这个 cookie 什么时候过期，expires 是 UTC 格式时间，maxAge 是 cookie 多久后过期的相对时间。当不设置这两个选项时，会产生 session cookie，session cookie 是 transient 的，当用户关闭浏览器时，就被清除。一般用来保存 session 的 session_id。</li>
<li>secure：当 secure 值为 true 时，cookie 在 HTTP 中是无效，在 HTTPS 中才有效。</li>
<li>httpOnly：浏览器不允许脚本操作 document.cookie 去更改 cookie。一般情况下都应该设置这个为 true，这样可以避免被 xss 攻击拿到 cookie。</li>
</ul>
<blockquote>
<p>所以为了使得关闭浏览器清除cookie应该不设置expires/max-age，深层的原理，当设置expires/max-age后，浏览器默认会把cookie存放到硬盘里面，所以即使关闭浏览器，甚至关闭电脑后，下次打开浏览器仍然会保存着cookie的信息。</p>
</blockquote>
<p>可是查看<code>koa-generic-session</code>的源码可以发现：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> defaultCookie = &#123;</div><div class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">  <span class="attr">overwrite</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">signed</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">maxAge</span>: <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">//one day in ms</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>maxAge默认时间为1天，所以需要修改源码为：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> defaultCookie = &#123;</div><div class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">  <span class="attr">overwrite</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">signed</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">maxAge</span>: <span class="literal">null</span> <span class="comment">//one day in ms</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>如果有需要可以在index.js中设置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">app.use(session(&#123;</div><div class="line">  <span class="attr">store</span>: redisStore(),</div><div class="line">  <span class="attr">cookie</span>: &#123;</div><div class="line">    <span class="attr">httpOnly</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">    <span class="attr">overwrite</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">signed</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">maxAge</span>: <span class="literal">null</span> <span class="comment">//one hour in ms</span></div><div class="line">  &#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure></p>
<p>好了大功告成</p>
<h2 id="fetch中cookie问题"><a href="#fetch中cookie问题" class="headerlink" title="fetch中cookie问题"></a>fetch中cookie问题</h2><p>理论上所以http请求都应该带上cookie，可是fetch比较坑</p>
<blockquote>
<p>Fetch 请求默认是不带 cookie 的，需要设置 fetch(url, {credentials: ‘include’})</p>
</blockquote>
<p>ajax版本<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> key = <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>).value;</div><div class="line"> <span class="keyword">var</span> val = <span class="built_in">document</span>.getElementById(<span class="string">'lab-create-input'</span>).value;</div><div class="line"> <span class="keyword">if</span> (key.trim() === <span class="string">''</span> || val.trim() === <span class="string">''</span>) &#123;</div><div class="line">   alert(<span class="string">'关键字或者回复，不能为空'</span>);</div><div class="line"> &#125; <span class="keyword">else</span> &#123;</div><div class="line">   <span class="keyword">var</span> data = &#123;</div><div class="line">     <span class="attr">key</span>: key,</div><div class="line">     <span class="attr">val</span>: val</div><div class="line">   &#125;;</div><div class="line">   <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">   xhr.open(<span class="string">'post'</span>, <span class="string">'/weixin/addK'</span>, <span class="literal">true</span>);</div><div class="line">   xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</div><div class="line">       <span class="keyword">var</span> result,</div><div class="line">         status = xhr.status;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> ((status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) || status === <span class="number">304</span>) &#123;</div><div class="line">         result = xhr.responseText;</div><div class="line">         <span class="built_in">console</span>.log(result);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">         <span class="built_in">console</span>.log(<span class="string">"ERR"</span>, xhr.status);</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;;</div><div class="line">   xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</div><div class="line">   xhr.send(<span class="built_in">JSON</span>.stringify(data));</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>fetch版本<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> key = <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>).value;</div><div class="line"><span class="keyword">var</span> val = <span class="built_in">document</span>.getElementById(<span class="string">'lab-create-input'</span>).value;</div><div class="line"><span class="keyword">if</span> (key.trim() === <span class="string">''</span> || val.trim() === <span class="string">''</span>) &#123;</div><div class="line">  alert(<span class="string">'关键字或者回复，不能为空'</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  <span class="keyword">var</span> data = &#123;</div><div class="line">    <span class="attr">key</span>: key,</div><div class="line">    <span class="attr">val</span>: val</div><div class="line">  &#125;;</div><div class="line">  data = <span class="built_in">JSON</span>.stringify(data);</div><div class="line">  fetch(<span class="string">'/weixin/addK'</span>, &#123;</div><div class="line">    <span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">    <span class="attr">credentials</span>: <span class="string">'include'</span>,</div><div class="line">    <span class="attr">headers</span>: &#123;</div><div class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">body</span>: data</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="fetch坑"><a href="#fetch坑" class="headerlink" title="fetch坑"></a>fetch坑</h3><ul>
<li>Fetch 请求默认是不带 cookie 的，需要设置 fetch(url, {credentials: ‘include’})</li>
<li>服务器返回 400，500 错误码时并不会 reject，只有网络错误这些导致请求不能完成时，fetch 才会被 reject。</li>
<li>IE8 IE9的XHR不支持CORS跨域,推荐使用fetch-jsonp</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://www.jianshu.com/p/fc7c0954b6e5" target="_blank" rel="external">简书 KeKeMars</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/30/koa-nginx-反向代理/" itemprop="url">
                koa-nginx-反向代理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-30T11:34:40+08:00" content="2016-03-30">
            2016-03-30
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/03/30/koa-nginx-反向代理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/30/koa-nginx-反向代理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>最近在做一个基于koa的微信公众平台脚手架（过一段时间会放到我的github上），由于我只有一个域名demozhan.com，现在同时有好几个web应用在上面挂载着，所以只能做一下反向代理，可是反向代理只能代理动态文件，对于静态资源貌似没有什么好的解决方法</p>
</blockquote>
<p>本文针对以上问题进行逐步解决，通过修改<code>nginx</code>相关配置，并结合<code>koa-router</code>以及<code>koa-static</code>，就可以解决上述问题。</p>
<h2 id="配置koa-static解决端口下静态文件的问题"><a href="#配置koa-static解决端口下静态文件的问题" class="headerlink" title="配置koa-static解决端口下静态文件的问题"></a>配置koa-static解决端口下静态文件的问题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</div><div class="line"><span class="comment">// 使用./public下的静态文件</span></div><div class="line">app.use(serve(__dirname + <span class="string">'/public'</span>));</div></pre></td></tr></table></figure>
<p>通过以上配置就可以将public文件夹作为静态文件夹，在请求<a href="http://localhost:3333/login/css/index.css的时候就会去查找本地文件夹" target="_blank" rel="external">http://localhost:3333/login/css/index.css的时候就会去查找本地文件夹</a></p>
<p>通过以上过程就解决了，不做反向代理情况下的静态文件的配置</p>
<h2 id="配置nginx实现反向代理"><a href="#配置nginx实现反向代理" class="headerlink" title="配置nginx实现反向代理"></a>配置nginx实现反向代理</h2><h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">location</span> <span class="title">/weixin</span> &#123;</div><div class="line">		proxy_pass http://localhost:<span class="number">3333</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个没什么好讲的，可是直接这样的操作导致整个页面都访问不到</p>
<blockquote>
<p>直接反向代理请求/weixin/login/会代理到3333端口，但是请求的path依旧是/weixin/login/</p>
</blockquote>
<p>解决方案：添加router前缀，保证请求链接一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> Router(&#123;</div><div class="line">  <span class="attr">prefix</span>: <span class="string">'/weixin'</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>通过以上方法，请求/weixin/login链接就对应router中的login</p>
<h2 id="静态文件失效"><a href="#静态文件失效" class="headerlink" title="静态文件失效"></a>静态文件失效</h2><p>通过以上配置，login页面渲染出来了，可是加载的css文件都404了。</p>
<p>通过调试koa-static分析原因，由于修改了router的前缀了，所以所有静态文件请求都变成/weixin/css/login.css；请求链接错误</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><blockquote>
<p>大概思路就是通过传入一个参数，表示要去除的路径，改变path路径，koa-static的具体原理我还没有深入</p>
</blockquote>
<p>修改koa-static源码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!opts.defer) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> * <span class="title">serve</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.method == <span class="string">'HEAD'</span> || <span class="keyword">this</span>.method == <span class="string">'GET'</span>) &#123;</div><div class="line">      <span class="comment">//在默认情况下this.path = '/css/style.css' 会转变为本地.../public/css/style.css文件路径</span></div><div class="line">      <span class="comment">//由于做了反向代理this.path = '/weixin/css/style.css'</span></div><div class="line">      <span class="comment">//由于做了反向代理需要修改静态文件的path = '/css/style.css'</span></div><div class="line">      <span class="keyword">var</span> path</div><div class="line">      <span class="keyword">if</span> (opts.proxy) &#123;</div><div class="line">        path = <span class="keyword">this</span>.path.replace(opts.proxy, <span class="string">''</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        path = <span class="keyword">this</span>.path;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (<span class="keyword">yield</span> send(<span class="keyword">this</span>, path, opts)) <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">yield</span>* next;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h2><p>index.js的代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</div><div class="line"><span class="keyword">var</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>);</div><div class="line"><span class="keyword">var</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</div><div class="line"><span class="keyword">var</span> app = koa();</div><div class="line"><span class="keyword">var</span> Weixin = <span class="built_in">require</span>(<span class="string">'./weixin/weixin'</span>)(<span class="string">'zhanfang'</span>);</div><div class="line"><span class="keyword">var</span> router = <span class="keyword">new</span> Router(&#123;</div><div class="line">  <span class="attr">prefix</span>: <span class="string">'/weixin'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//路由配置</span></div><div class="line">router.get(<span class="string">'/login'</span>, Weixin.webLogin());</div><div class="line"></div><div class="line"><span class="comment">// 使用./public下的静态文件</span></div><div class="line">app.use(serve(__dirname + <span class="string">'/public'</span>, &#123;</div><div class="line">  <span class="attr">proxy</span>: <span class="string">'/weixin'</span></div><div class="line">&#125;));</div><div class="line"></div><div class="line">app.use(logger());</div><div class="line">app.use(router.routes())</div><div class="line">  .use(router.allowedMethods());</div><div class="line"></div><div class="line">app.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(err);</div><div class="line">&#125;)</div><div class="line">app.listen(<span class="number">3333</span>);</div></pre></td></tr></table></figure></p>
<p>login.html的部分代码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/login.css"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div></pre></td></tr></table></figure></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/22/react-render错误/" itemprop="url">
                react基础render错误
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-22T13:44:13+08:00" content="2016-03-22">
            2016-03-22
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/03/22/react-render错误/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/22/react-render错误/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>真是比了狗了，弄了一早上react，写个最简单的组件都能出错，错误提示如下</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ERROR <span class="keyword">in</span> ./src/index.jsx</div><div class="line">Module build failed: <span class="built_in">SyntaxError</span>: <span class="regexp">/Users/</span>zhan/Documents/study/weui/my-weui-base/src/index.jsx: Unexpected token (<span class="number">16</span>:<span class="number">6</span>)</div><div class="line">  <span class="number">14</span> |   render() &#123;</div><div class="line">  <span class="number">15</span> |     <span class="keyword">return</span> (</div><div class="line">&gt; <span class="number">16</span> |       <span class="xml"><span class="tag">&lt;<span class="name">Button</span>&gt;</span>hello wechat<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></div><div class="line">     |       ^</div><div class="line">  <span class="number">17</span> |       );</div><div class="line">  <span class="number">18</span> |   &#125;</div><div class="line">  <span class="number">19</span> | &#125;</div></pre></td></tr></table></figure>
<p>最后上网一看发现有人也遇到这个问题，他说babel的版本不能高于6.4，结果我把package.json改为如下形式，就通过了，简直醉了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"babel"</span>: <span class="string">"^5.8.23"</span>,</div><div class="line"><span class="string">"babel-core"</span>: <span class="string">"^5.8.23"</span>,</div><div class="line"><span class="string">"babel-loader"</span>: <span class="string">"^5.3.2"</span>,</div></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/15/eslint/" itemprop="url">
                ESLint配置ES6实例
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-15T23:18:03+08:00" content="2016-03-15">
            2016-03-15
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/03/15/eslint/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/15/eslint/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>今天开始使用Atom + eslint，感觉很不错</p>
</blockquote>
<pre><code>{
    // 配置ES6支持
  &quot;parserOptions&quot;: {
    &quot;ecmaVersion&quot;: 6,
    &quot;sourceType&quot;: &quot;module&quot;,
    &quot;ecmaFeatures&quot;: {
      &quot;jsx&quot;: true
    },
  },
  &quot;rules&quot;: {
          // 配置缩进
    &quot;indent&quot;: [2, 2],
    &quot;no-unused-vars&quot;: 2,
    &quot;no-alert&quot;: 1
  },
  //配置支持环境
  &quot;env&quot;: {
    &quot;browser&quot;: true,
    &quot;node&quot;: true,
  }
}
</code></pre><p>还可以在 package.json中进行配置，如下：</p>
<pre><code>&quot;name&quot;: &quot;mypackage&quot;,
&quot;version&quot;: &quot;0.0.1&quot;,
&quot;eslintConfig&quot;: {
    &quot;env&quot;: {
        &quot;browser&quot;: true,
        &quot;node&quot;: true
    }
}
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/15/webpack-config-js/" itemprop="url">
                webpack实例
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-15T22:17:47+08:00" content="2016-03-15">
            2016-03-15
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/03/15/webpack-config-js/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/15/webpack-config-js/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>之前就用过webpack，只是一直是知其然而不知其所以然，所以决定自己配置一遍，还是遇到了一些坑</p>
</blockquote>
<h2 id="webpack的优点"><a href="#webpack的优点" class="headerlink" title="webpack的优点"></a>webpack的优点</h2><ul>
<li>对 CommonJS 、 AMD 、ES6的语法做了兼容</li>
<li>对js、css、图片等资源文件都支持打包</li>
<li>有独立的配置文件webpack.config.js</li>
<li>可以将代码切割成不同的chunk，实现按需加载，降低了初始化时间</li>
<li>支持 SourceUrls 和 SourceMaps，易于调试</li>
<li>具有强大的Plugin接口，大多是内部插件，使用起来比较灵活</li>
<li>webpack 使用异步 IO 并具有多级缓存。这使得 webpack 很快且在增量编译上更加快</li>
</ul>
<h2 id="利用npm-script启动webpack"><a href="#利用npm-script启动webpack" class="headerlink" title="利用npm script启动webpack"></a>利用npm script启动webpack</h2><p>webpack并没有提供自动刷新的功能，导致每次修改代码都必须要再执行一次webpack，因此需要使用webpack-dev-server</p>
<p>webpack-dev-server 提供了两种模式用于自动刷新页面：</p>
<ul>
<li><p>iframe 模式<br>我们不访问 <a href="http://localhost:8080，而是访问" target="_blank" rel="external">http://localhost:8080，而是访问</a> <a href="http://localhost:8080/webpack-dev-server/index.html" target="_blank" rel="external">http://localhost:8080/webpack-dev-server/index.html</a></p>
</li>
<li><p>inline 模式<br>在命令行中指定该模式，webpack-dev-server –inline。这样 <a href="http://localhost:8080/index.html" target="_blank" rel="external">http://localhost:8080/index.html</a> 页面就会在 js 文件变化后自动刷新了。</p>
</li>
</ul>
<p>以上说的两个页面自动刷新的模式都是指刷新整个页面，相当于点击了浏览器的刷新按钮。</p>
<p>webpack-dev-server 还提供了一种 –hot 模式</p>
<pre><code>&quot;scripts&quot;: {
  &quot;build&quot;: &quot;webpack -d&quot;,
  &quot;dev&quot;: &quot;webpack-dev-server -d --inline --devtool eval --progress --colors --content-base dist&quot;
},
</code></pre><ul>
<li>webpack-dev-server: 在 localhost:8080 建立一个 Web 服务器</li>
<li>-d: 提供source map，方便调试。</li>
<li>–inline: 自动刷新</li>
<li>–devtool eval: 为你的代码创建源地址。当有任何报错的时候可以让你更加精确地定位到文件和行号</li>
<li>–progress: 显示合并代码进度</li>
<li>–colors: 在命令行中显示颜色</li>
<li>–content-base dist:指向设置的输出目录</li>
</ul>
<h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><pre><code>// 为了保证windows下面路径正确，最好使用path路径
var path = require(&apos;path&apos;);

module.exports = {
    // 入口文件，一般利用入口文件来引入其他模块
  entry: [
    path.resolve(__dirname, &apos;src/entry.js&apos;)
  ],
  // 打包后的文件
  output: {
    path: path.join(__dirname, &apos;dist&apos;),
    filename: &apos;bundle.js&apos;
  },
  // 官方解释：https://webpack.github.io/docs/library-and-externals.html
  // 我认为是整个运行过程中都需要依赖的库，react应用程序运行过程中一直需要react库
  externals: {
    &apos;react&apos;: &apos;React&apos;
  },
  // 模块加载关系
  module: {
    loaders: [{
         // 对于.js结尾的文件以es6方式加载
      test: /\.js$/,
      // loader: jsx!babel = loaders: [&apos;style&apos;, &apos;css&apos;]
      loader: &apos;jsx!babel&apos;,
      // 包含的文件，千万注意不要使用&apos;&apos;
      include: /src/
    }, {
      test: /\.css$/,
      loader: &apos;style!css&apos;
    }]
  },
  // source-map 在新版chrome下要用cmd+p调出来
  devtool: &quot;#inline-source-map&quot;
}
</code></pre><h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><pre><code>include: /src/
</code></pre><p>如果写成</p>
<pre><code>include: &apos;/src/&apos;
</code></pre><p>没有import和export的模式下编译并不会报错，但是在如下情况就会报错</p>
<pre><code>import List from &apos;./List&apos;
</code></pre><p>错误如下：</p>
<pre><code>ERROR in ./src/component/App.js
Module parse failed: /Users/zhan/Documents/React/webpack/160315_webpack_study/src/component/App.js Line 2: Unexpected token
You may need an appropriate loader to handle this file type.
| &apos;use strict&apos;;
| import React from &quot;react&quot;;
|
| class App {
 @ ./src/entry.js 2:0-26
</code></pre><h2 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h2><blockquote>
<p>source-map还需要深入研究一下</p>
</blockquote>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/27/窗口-元素大小/" itemprop="url">
                窗口/元素大小
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-27T10:02:43+08:00" content="2016-02-27">
            2016-02-27
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/02/27/窗口-元素大小/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/27/窗口-元素大小/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><blockquote>
<p>由于最近想重新设计弹窗效果频繁设计窗口大小，以及之前的滚动效果也涉及到滚动窗大小，所以决定弄清楚。</p>
</blockquote>
<h2 id="元素大小"><a href="#元素大小" class="headerlink" title="元素大小"></a>元素大小</h2><p>这部分内容可参见《JAVASCRIPT高级程序设计第三版》第320页</p>
<h3 id="偏移量"><a href="#偏移量" class="headerlink" title="偏移量"></a>偏移量</h3><ul>
<li>offsetHeight：包括元素的高度、（可见的）水平滚动条高度、上&amp;下边框高度</li>
<li>offsetWidth：包括元素的宽度、（可见的）垂直滚动条高度、左&amp;右边框高度</li>
<li>offsetLeft：元素左边框至包含元素的左内边框之间的像素距离</li>
</ul>
<p>这里可以解释body元素即使存在margin，它的offsetLeft也为0。 <strong>因为body元素的offsetParent是null,也就是相当于它自身，所以它的offsetLeft为0。</strong></p>
<pre><code>console.log(document.body.offsetParent);//null
console.log(document.body.offsetLeft);//0
</code></pre><ul>
<li>offsetTop：元素上边框至包含元素的上内边框之间的像素距离</li>
</ul>
<h3 id="客户区大小"><a href="#客户区大小" class="headerlink" title="客户区大小"></a>客户区大小</h3><ul>
<li>clientWidth：内容加左右padding</li>
<li>clientHeight：内容加上下padding</li>
</ul>
<h3 id="滚动大小"><a href="#滚动大小" class="headerlink" title="滚动大小"></a>滚动大小</h3><ul>
<li>scrollHeight：元素内容的<strong>总</strong>高度</li>
<li>scrollWidth：元素内容的<strong>总</strong>宽度</li>
<li>scrollLeft：被隐藏在内容区域左侧的像素数。通过设置这个属性可以改变元素的滚动位置</li>
<li>scrollTop：被隐藏在内容区域上方的像素数。通过设置这个属性可以改变元素的滚动位置</li>
</ul>
<p>对于body来说它如果存在滚动条页面总高度就是</p>
<pre><code>document.documentElement.scrollHeight;
</code></pre><p>对于运行在混杂模式的IE，需要用<code>doument.body</code>代替<code>document.documentElement</code>。</p>
<h3 id="确定元素大小"><a href="#确定元素大小" class="headerlink" title="确定元素大小"></a>确定元素大小</h3><p>利用方法getBoundingClientRect()，返回一个矩形对象，包含left、top、right、bottom。IE8之前认为左上角坐标为（2，2），其他浏览器认为是（0，0）。</p>
<h2 id="获取浏览器窗口大小"><a href="#获取浏览器窗口大小" class="headerlink" title="获取浏览器窗口大小"></a>获取浏览器窗口大小</h2><p>最佳方法</p>
<pre><code>document.documentElement.clientHeight;
document.documentElement.clientWidth;
</code></pre><p>或者如下，但要求body的magrin为0</p>
<pre><code>body{
    margin:0;    
}
document.body.clientHeight;
document.body.clientWidth;
</code></pre><p>同时，除了IE以外的所有浏览器都将此信息保存在window对象中，可以用以下获取：</p>
<pre><code>window.innerHeight;
window.innerWidth;
</code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>JAVASCRIPT高级程序设计（第三版）</li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/22/页面加载/" itemprop="url">
                页面加载
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-22T13:59:36+08:00" content="2016-02-22">
            2016-02-22
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/02/22/页面加载/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/22/页面加载/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="页面初始化加载"><a href="#页面初始化加载" class="headerlink" title="页面初始化加载"></a>页面初始化加载</h2><p>曾经常用的两种写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">".gravatar"</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//...</span></div><div class="line">    &#125;);</div><div class="line">    <span class="comment">//以及其他操作DOM的节点</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二种方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//操作DOM相关</span></div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="页面加载"><a href="#页面加载" class="headerlink" title="页面加载"></a>页面加载</h2><p>页面加载就是从你输入网址+enter开始，发生的一些列过程，最终到页面显示。 从微观上分的话，<strong>页面加载有两部分<br>一个是以DOMContentLoaded触发为标志的DOM树的渲染完成<br>一个是以辅助资源img,font加载完成为触发标志的onload事件<br>他们两个的具体区别就是”资源的加载”这个关键点。</strong></p>
<p>在获得数据响应后,页面开始解析,发生的过程为:</p>
<ol>
<li>解析HTML结构。 </li>
<li>加载外部脚本和样式表文件。 </li>
<li>解析并执行脚本代码。 </li>
<li>构造HTML DOM模型。//ready执行 </li>
<li>加载图片等外部文件。 </li>
<li>页面加载完毕。//onload执行</li>
</ol>
<p>这只是，页面加载很浅的一块，前端能在页面加载上做的工作其实超级多。 要知道， 从你输入网站 + enter键后，发生的过程为:</p>
<blockquote>
<p>重定向=&gt;检查DNS缓存=&gt; DNS解析 =&gt; TCP连接 =&gt; 发请求 =&gt; 得到响应=&gt; 浏览器处理 =&gt; 最后onload</p>
</blockquote>
<h2 id="宏观页面加载"><a href="#宏观页面加载" class="headerlink" title="宏观页面加载"></a>宏观页面加载</h2><p>如果我们想深入了解宏观页面加载，需要掌握ECMA5新给出的一个API。 performance . 是不是 感觉很熟悉呢？</p>
<h3 id="performance简单讲解"><a href="#performance简单讲解" class="headerlink" title="performance简单讲解"></a>performance简单讲解</h3><p>以前，我们来检查浏览器的时候，大部分情况下是使用</p>
<pre><code>console.time(specialNum);
console.timeEnd(specialNum);
</code></pre><p>或者</p>
<pre><code>new Date().getTime();
//或者
Date.now();
</code></pre><p>上面说的两种方法， 获取的精度都是毫秒级(10^-6) ，对于一些非常精确的测试，他们的作用来还是蛮有限的，而且获取数据的方式，也比较complicated.</p>
<p>ES5提出的performance可以获取到，微秒级别(10^-9) 。而且，能够得到后台事件的更多时间数据。</p>
<p>他的兼容性是IE9+ 。 觉得已经足够了。</p>
<h2 id="performance-timing对象"><a href="#performance-timing对象" class="headerlink" title="performance.timing对象"></a>performance.timing对象</h2><p>通常，我们可以从performance.timing对象上，获得我们想要的一切时间值<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/timing-overview.png" alt="alt"><br>比如，我们获得重定向时间用:</p>
<pre><code>var time = performance.timing;
var redirect = time.redirectEnd - time.redirectStart; //单位为微秒
</code></pre><p>即DOMContentLoaded事件 是在domContentLoaded那段触发的。图中所指的domContentLoaded其实分为两块, 一个是domContentLoadedEventStart和domContentLoadedEventEnd. 详见下述说明:(from 赖小赖小赖)</p>
<h2 id="performance-now"><a href="#performance-now" class="headerlink" title="performance.now()"></a>performance.now()</h2><p>通常，我们会将该方法和Date.now()进行一个对比。</p>
<p>performance.now();  //输出是微秒级别<br>Date.now();  //输出是毫秒级别<br>其中Date.now()是输出 从1970年开始的毫秒数.<br>performance.now()参考的是从.performance.timing.navigationStart(页面开始加载)的时间, 到现在的微秒数.<br>这里，我们可以使用performance.now()来模拟获取DomContentLoaded的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> timesnipe = performance.now();</div><div class="line">        <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(performance.now() - timesnipe);</div><div class="line">        &#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">           <span class="built_in">console</span>.log(performance.now() - timesnipe);</div><div class="line">        &#125;, <span class="literal">false</span>);</div><div class="line"><span class="comment">//但是这样并不等同于,只能算作约等于</span></div><div class="line">performance.timing.domContentLoadedEventStart - performance.timing.domLoading; <span class="comment">//检测domLoadEvent触发时间</span></div></pre></td></tr></table></figure>
<p>上面不相等的原因就在于，当执行script的时候，DOM其实已经开始解析DOM和页面内容， 所以会造成时间上 比 真实时间略短。另外performance还有其他几个API,比如makr,getEntries. 不过，这里因为和页面显示的关系不是很大，这里就不做过多的讲解了。 有兴趣，可以参考:赖小赖小赖<br>接下来，我们一步一步来看一下，页面加载的整个过程.</p>
<h2 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h2><p>这是页面加载的第一步(也有可能没有). 比如，当一个页面已经迁移，但是你输入原来的网站地址的时候就会发生。<br>或者， 比如example.com -&gt; m.example.com/home 。 这样耗费的时间成本是双倍的。 这里就会经过两次DNS解析，TCP连接，以及请求的发送。所以，在后台设置好正确的网址是很重要的。<br>如图:<br><img src="http://7xltvd.com1.z0.glb.clouddn.com/redirect.jpg" alt="alt"><br>这里，我们可以使用.performance的属性,计算出重定向时间</p>
<pre><code>redirectTime = redirectEnd - redirectStart
</code></pre><h2 id="cache-DNS-TCP-Request-Response"><a href="#cache-DNS-TCP-Request-Response" class="headerlink" title="cache,DNS,TCP,Request,Response"></a>cache,DNS,TCP,Request,Response</h2><p>如果我们的域名输入正确的话，接着，浏览器会查询本地是否有域名缓存(appCache)，如果有，则不需要进行DNS解析，否则需要对域名进行解析，找到真实的IP地址，然后建立3次握手连接， 发送请求， 最后接受数据。 通常，这一部分，可以做的优化有:<br>发送请求的优化:加异地机房，加CDN.(加快解析request)<br>请求加载数据的优化:页面内容经过 gzip 压缩，静态资源 css/js 等压缩(request到response的优化)<br>ok~ 使用performance测试时间为:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DNS 缓存时间</span></div><div class="line">    times.appcache = t.domainLookupStart - t.fetchStart;</div><div class="line"><span class="comment">// TCP 建立连接完成握手的时间</span></div><div class="line">    times.connect = t.connectEnd - t.connectStart;</div><div class="line"><span class="comment">//DNS 查询时间</span></div><div class="line">    times.lookupDomain = t.domainLookupEnd - t.domainLookupStart;</div><div class="line"><span class="comment">//整个解析时间</span></div><div class="line"><span class="keyword">var</span> lookup = t.responseEnd - t.fetchStart;</div></pre></td></tr></table></figure>
<p>其实，只要对照那个图查查over，不用太关注上面的式子。使用时需要注意，performance的相关操作，最好放在onload的回调中执行，避免出现异常的bug.</p>
<h2 id="jquery-ready事件浅析"><a href="#jquery-ready事件浅析" class="headerlink" title="jquery ready事件浅析"></a>jquery ready事件浅析</h2><p>jquery主要做的工作就是兼容IE6,7,8实现DOMContentLoaded的效果.由于现在主流只要兼容到IE8, 剩下IE6,7我们不做过多的分析了。<br>目前流行的做法有两种， 一种是使用readystatechange实现，另外一种使用IE自带的doScroll方法实现.</p>
<h3 id="readyStateChange"><a href="#readyStateChange" class="headerlink" title="readyStateChange"></a>readyStateChange</h3><p>这其实是IE6，7，8的特有属性，用它来标识某个元素的加载状态。 但是现在w3c规定，只有xhr才有这个事件。 所以，这里，我们一般只能在IE中使用readyStateChange否则，其他浏览器是没有效果的。<br>详见:readyState兼容性分析<br>这样，我们模拟jquery的ready事件时就可以使用:</p>
<pre><code>document.onreadystatechange = function () {
  if (document.readyState == &quot;interactive&quot; || document.readyState == &quot;complete&quot;) {
        //添加回调...
  }
}
</code></pre><p>理想很丰满，现实很骨感。 事实上, 当readyState为interactive时， Dom的结构并未完全稳定，如果还有其他脚本影响DOM时, 这时候可能会造成bug。 另外为complete时， 这时候图片等相关资源已经加载完成。 这个时候模拟触发DOMContentLoaded事件，其实和onload事件触发时间并没有太久的时间距离。 这种方式兼容低版本IE还是不太可靠的。<br>另外提供一个doScroll方式</p>
<h3 id="doScroll兼容"><a href="#doScroll兼容" class="headerlink" title="doScroll兼容"></a>doScroll兼容</h3><p>这是IE低版本特有的，不过IE11已经弃用了。 使用scrollLeft和scrollTop代替. doScroll 的主要作用是检测DOM结构是否问题， 通常我们会使用轮询来检测doScroll是否可用，当可用的时候一定是DOM结构稳定，图片资源还未加载的时候。<br>我们来看一下jquery中实现doScroll的兼容:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">  <span class="comment">//低版本的IE浏览器，这里添加监听作为向下兼容，如果doScroll执行出现bug，也能保证ready函数的执行</span></div><div class="line">            <span class="built_in">document</span>.attachEvent( <span class="string">"onreadystatechange"</span>, DOMContentLoaded );</div><div class="line">            <span class="built_in">window</span>.attachEvent( <span class="string">"onload"</span>, jQuery.ready );</div><div class="line"><span class="comment">//在ready里面会对执行做判断，确保只执行一次</span></div><div class="line">            <span class="keyword">var</span> top = <span class="literal">false</span>;</div><div class="line"><span class="comment">// 如果是IE且不是iframe就通过不停的检查doScroll来判断dom结构是否ready</span></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    top = <span class="built_in">window</span>.frameElement == <span class="literal">null</span> &amp;&amp; <span class="built_in">document</span>.documentElement;</div><div class="line">&#125; <span class="keyword">catch</span>(e) &#123;&#125;</div><div class="line"><span class="keyword">if</span> ( top &amp;&amp; top.doScroll ) &#123;</div><div class="line">    (<span class="function"><span class="keyword">function</span> <span class="title">doScrollCheck</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> ( !jQuery.isReady ) &#123;<span class="comment">//ready方法没有执行过</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">// 检查是否可以向左scroll滑动,当dom结构还没有解析完成时会抛出异常</span></div><div class="line">                top.doScroll(<span class="string">"left"</span>);</div><div class="line">            &#125; <span class="keyword">catch</span>(e) &#123;</div><div class="line">                <span class="comment">//递归调用,直到当dom结构解析完成</span></div><div class="line">                <span class="keyword">return</span> setTimeout( doScrollCheck, <span class="number">50</span> );</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//没有发现异常,表示dom结构解析完成,删除之前绑定的onreadystatechange事件</span></div><div class="line">            </div><div class="line">            <span class="comment">//执行jQuery的ready方法</span></div><div class="line">            jQuery.ready();</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">&#125;</div><div class="line"><span class="comment">//看看jQuery.ready()方法:</span></div><div class="line">ready:<span class="function"><span class="keyword">function</span>(<span class="params">wait</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (wait === <span class="literal">true</span> ? --jQuery.readyWait : jQuery.isReady) &#123;</div><div class="line">        <span class="comment">//判断页面是否已完成加载并且是否已经执行ready方法</span></div><div class="line">        <span class="comment">//通过isReady状态进行判断, 保证只执行一次</span></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!<span class="built_in">document</span>.body) &#123;</div><div class="line">        <span class="keyword">return</span> setTimeout(jQuery.ready);</div><div class="line">    &#125;</div><div class="line">    jQuery.isReady = <span class="literal">true</span>; <span class="comment">//指示ready方法已被执行</span></div><div class="line">      <span class="comment">//这也是上面两次绑定事件的原因,会保证只执行一次</span></div><div class="line">    <span class="keyword">if</span> (wait !== <span class="literal">true</span> &amp;&amp; --jQuery.readyWait &gt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//以下是处理ready的状态</span></div><div class="line">    readyList.resolveWith(<span class="built_in">document</span>, [jQuery]);</div><div class="line">    <span class="keyword">if</span> (jQuery.fn.trigger) &#123;</div><div class="line">    <span class="comment">//解除引用</span></div><div class="line">        jQuery(<span class="built_in">document</span>).trigger(<span class="string">"ready"</span>).off(<span class="string">"ready"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上就是jquery 兼容ready的方法。</p>
<h2 id="转载"><a href="#转载" class="headerlink" title="转载"></a>转载</h2><ul>
<li><a href="https://segmentfault.com/a/1190000004466407" target="_blank" rel="external">segmentfault</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/21/http2/" itemprop="url">
                http2
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-21T21:14:10+08:00" content="2016-02-21">
            2016-02-21
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/02/21/http2/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/21/http2/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="目前克服延长的方法"><a href="#目前克服延长的方法" class="headerlink" title="目前克服延长的方法"></a>目前克服延长的方法</h2><ul>
<li>图片精灵(Spriting)</li>
<li>内联(Inlining)</li>
</ul>
<p>Inlining是另外一种防止发送很多小图请求的技巧，它将图片的原始数据嵌入在CSS文件里面的URL里。而这种方案的优缺点跟Spriting很类似。</p>
<pre><code>.icon1 {
    background: url(data:image/png;base64,&lt;data&gt;) no-repeat;
  }
.icon2 {
    background: url(data:image/png;base64,&lt;data&gt;) no-repeat;
  }
</code></pre><ul>
<li>拼接(Concatenation)</li>
<li>分片(Sharding)</li>
</ul>
<p>Sharding就是把你的服务分散在尽可能多的主机上</p>
<h2 id="http2特点"><a href="#http2特点" class="headerlink" title="http2特点"></a>http2特点</h2><h3 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h3><p>http2是一个二进制协议。</p>
<p>基于二进制的http2可以使成帧的使用变得更为便捷。在HTTP1.1和其他基于文本的协议中，对帧的起始和结束识别起来相当复杂。而通过移除掉可选的空白符以及其他冗余后，再来实现这些会变得更容易。</p>
<p>而另一方面，这项决议同样使得我们可以更加便捷的从帧结构中分离出那部分协议本身的内容。而在HTTP1中，各个部分相互交织，犹如一团乱麻。</p>
<h3 id="多路复用的流"><a href="#多路复用的流" class="headerlink" title="多路复用的流"></a>多路复用的流</h3><p>每个单独的http2连接都可以包含多个并发的流，这些流中交错的包含着来自两端的帧。流既可以被客户端/服务器端单方面的建立和使用，也可以被双方共享，或者被任意一边关闭。在流里面，每一帧发送的顺序非常关键。接收方会按照收到帧的顺序来进行处理。</p>
<h3 id="优先级和依赖性"><a href="#优先级和依赖性" class="headerlink" title="优先级和依赖性"></a>优先级和依赖性</h3><p>每个流都包含一个优先级（也就是“权重”），它被用来告诉对端哪个流更重要。当资源有限的时候，服务器会根据优先级来选择应该先发送哪些流。</p>
<p>借助于PRIORITY帧，客户端同样可以告知服务器当前的流依赖于其他哪个流。该功能让客户端能建立一个优先级“树”，所有“子流”会依赖于“父流”的传输完成情况。</p>
<p>优先级和依赖关系可以在传输过程中被动态的改变。这样当用户滚动一个全是图片的页面的时候，浏览器就能够指定哪个图片拥有更高的优先级。或者是在你切换标签页的时候，浏览器可以提升新切换到页面所包含流的优先级。</p>
<h3 id="头压缩"><a href="#头压缩" class="headerlink" title="头压缩"></a>头压缩</h3><p>HTTP是一种无状态的协议。简而言之，这意味着每个请求必须要携带服务器需要的所有细节，而不是让服务器保存住之前请求的元数据。因为http2并没有改变这个范式，所以它也需要这样（携带所有细节）。</p>
<p>这也保证了HTTP可重复性。当一个客户端从同一服务器请求了大量资源（例如页面的图片）的时候，所有这些请求看起来几乎都是一致的，而这些大量一致的东西则正好值得被压缩。</p>
<p>当每个页面资源的个数上升的时候，cookies和请求的大小都会增加，而每个请求都会包含的cookie几乎是一模一样的。</p>
<p>HTTP 1.1请求的大小正变得越来越大，有时甚至会大于TCP窗口的初始大小，这会严重拖累发送请求的速度。因为它们需要等待带着ACK的响应回来以后，才能继续被发送。这也是另一个需要压缩的理由。</p>
<h3 id="重置-后悔药"><a href="#重置-后悔药" class="headerlink" title="重置 - 后悔药"></a>重置 - 后悔药</h3><p>HTTP 1.1的有一个缺点是：当一个含有确切值的Content-Length的HTTP消息被送出之后，你就很难中断它了。当然，通常你可以断开整个TCP链接（但也不总是可以这样），但这样导致的代价就是需要通过三次握手来重新建立一个新的TCP连接。</p>
<p>一个更好的方案是只终止当前传输的消息并重新发送一个新的。在http2里面，我们可以通过发送RST_STREAM帧来实现这种需求，从而避免浪费带宽和中断已有的连接。</p>
<h3 id="服务器推送"><a href="#服务器推送" class="headerlink" title="服务器推送"></a>服务器推送</h3><p>这个功能通常被称作“缓存推送”。主要的思想是：当一个客户端请求资源X，而服务器知道它很可能也需要资源Z的情况下，服务器可以在客户端发送请求前，主动将资源Z推送给客户端。这个功能帮助客户端将Z放进缓存以备将来之需。</p>
<p>服务器推送需要客户端显式的允许服务器提供该功能。但即使如此，客户端依然能自主选择是否需要中断该推送的流。如果不需要的话，客户端可以通过发送一个RST_STREAM帧来中止。</p>
<h3 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h3><p>http2上面每个流都拥有自己的公示的流量窗口，它可以限制另一端发送数据。如果你正好知道SSH的工作原理的话，这两者非常相似。</p>
<p>对于每个流来说，两端都必须告诉对方自己还有更多的空间来接受新的数据，而在该窗口被扩大前，另一端只被允许发送这么多数据。</p>
<p>而只有数据帧会受到流量控制。</p>
<h2 id="未来利用http2加载css的方式"><a href="#未来利用http2加载css的方式" class="headerlink" title="未来利用http2加载css的方式"></a>未来利用http2加载css的方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;head&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></div><div class="line">&lt;body&gt;</div><div class="line">  &lt;!-- HTTP/2 push this resource, or inline it, whichever's faster --&gt;</div><div class="line">  &lt;link rel="stylesheet" href="/site-header.css"&gt;</div><div class="line">  &lt;header&gt;…&lt;/header&gt;</div><div class="line"></div><div class="line">  &lt;link rel="stylesheet" href="/article.css"&gt;</div><div class="line">  &lt;main&gt;…&lt;/main&gt;</div><div class="line"></div><div class="line">  &lt;link rel="stylesheet" href="/comment.css"&gt;</div><div class="line">  &lt;section class="comments"&gt;…&lt;/section&gt;</div><div class="line"></div><div class="line">  &lt;link rel="stylesheet" href="/about-me.css"&gt;</div><div class="line">  &lt;section class="about-me"&gt;…&lt;/section&gt;</div><div class="line"></div><div class="line">  &lt;link rel="stylesheet" href="/site-footer.css"&gt;</div><div class="line">  &lt;footer&gt;…&lt;/footer&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.gitbook.com/book/ye11ow/http2-explained/details" target="_blank" rel="external">中文gitbook</a></li>
<li><a href="https://daniel.haxx.se/http2/" target="_blank" rel="external">英文版</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/20/负margin/" itemprop="url">
                负margin
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-20T21:28:40+08:00" content="2016-02-20">
            2016-02-20
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/02/20/负margin/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/20/负margin/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="负margin展示图"><a href="#负margin展示图" class="headerlink" title="负margin展示图"></a>负margin展示图</h2><p><img src="http://7xltvd.com1.z0.glb.clouddn.com/margin-1.jpg" alt="Alt" title="负margin移动方向"></p>
<p>Static元素是没有设定成浮动的元素，下图说明了负margin对static元素的作用</p>
<p>当static元素的margin-top/margin-left被赋予负值时，元素将被拉进指定的方向。例如：</p>
<pre><code>/* 元素向上移10px*/
#mydiv1 {margin-top:-10px;}
</code></pre><p><strong>但如果你设置margin-bottom/right为负数，元素并不会如你所想的那样向下/右移动，而是将后续的元素拖拉进来，覆盖本来的元素。</strong></p>
<pre><code>/* 
* #mydiv1后续元素向上移10px, #mydiv1 本身不移动
*/
#mydiv1 {margin-bottom:-10px;}    
</code></pre><h2 id="浮动元素上的负margin"><a href="#浮动元素上的负margin" class="headerlink" title="浮动元素上的负margin"></a>浮动元素上的负margin</h2><p>考虑下以下这种情况</p>
<pre><code>&lt;div id=&quot;mydiv1&quot;&gt;First&lt;/div&gt;
&lt;div id=&quot;mydiv2&quot;&gt;Second&lt;/div&gt;
</code></pre><p>如果给一个浮动元素加上相反方向的负margin，则会使行间距为0且内容重叠。这对于创建1列是100%宽度而其他列是固定宽度（比如100px）的自适应布局来说是非常有用的方法。</p>
<pre><code>/* 应用在与浮动相反方向的负margin */
#mydiv1 {float:left; margin-right:-100px;}    
</code></pre><p>若两个元素都为浮动，且#mydiv1的元素设定margin-right为20px。<strong>这样#mydiv2会认为#mydiv1的宽度比原来宽度缩短了20px（因此会导致重叠）。但有意思的是，#mydiv1的内容不受影响，保持原有的宽度。</strong></p>
<p>如果负margin等于实际宽度，则元素会被完全覆盖。这是因为元素的完全宽度等于margin，padding，border，width相加而成，所以如果负margin等于余下三者的和，那元素的实际宽度也就变成了0px。</p>
<h2 id="简单2列布局"><a href="#简单2列布局" class="headerlink" title="简单2列布局"></a>简单2列布局</h2><p>负margin也是一种创建简单2列自适应布局的好方法。2列自适应布局是一种拥有一个自适应宽度（liquid width）为100%的内容列和一个固定宽度侧边栏的布局。</p>
<pre><code>&lt;div id=&quot;content&quot;&gt; &lt;p&gt;Main content in here&lt;/p&gt; &lt;/div&gt; 
&lt;div id=&quot;sidebar&quot;&gt; &lt;p&gt;I’m the Sidebar! &lt;/p&gt; &lt;/div&gt;

#content {width:100%; float:left; margin-right:-200px;}
#sidebar {width:200px; float:left;}    
</code></pre><p>这样你就拥有了一个简单的两列布局，即使在IE6下也能无错的运行。现在，为了避免#sidebar被#content中的文字覆盖，加上</p>
<pre><code>/* 防止文本被重叠 */
#content p {margin-right:210px;}
/* 它是 200px + 10px, 10px是他们的间距*/
</code></pre><h3 id="三栏布局"><a href="#三栏布局" class="headerlink" title="三栏布局"></a>三栏布局</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&lt;style&gt;</div><div class="line">	body&#123;</div><div class="line">		margin: 0;</div><div class="line">		padding: 0;</div><div class="line">	&#125;</div><div class="line">	.left , .right&#123;</div><div class="line">		height: 300px;</div><div class="line">		width: 200px;</div><div class="line">		float: left;</div><div class="line">	&#125;</div><div class="line">	.right&#123;</div><div class="line">		/**/</div><div class="line">		margin-left: -200px;</div><div class="line">    	background-color: red;</div><div class="line">	&#125;</div><div class="line">	.left&#123;</div><div class="line">		/*移动到最左端*/</div><div class="line">		margin-left: -100%;</div><div class="line">		background-color: #080808;</div><div class="line">	&#125;</div><div class="line">	.middle&#123;</div><div class="line">		height: 300px;</div><div class="line">		width: 100%;</div><div class="line">		float: left;</div><div class="line">		background-color: blue;</div><div class="line">	&#125;</div><div class="line">	.middle .m&#123;</div><div class="line">  		margin-left:200px;</div><div class="line">	&#125;</div><div class="line">&lt;/style&gt;</div><div class="line"></div><div class="line">&lt;!--放第一行--&gt;</div><div class="line">&lt;div class="middle"&gt;</div><div class="line">	&lt;div class="m"&gt;middle&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;div class="left"&gt;left&lt;/div&gt;</div><div class="line">&lt;div class="right"&gt;right&lt;/div&gt;</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>英文原文：<a href="http://coding.smashingmagazine.com/2009/07/27/the-definitive-guide-to-using-negative-margins" target="_blank" rel="external">http://coding.smashingmagazine.com/2009/07/27/the-definitive-guide-to-using-negative-margins</a></li>
<li>中文译文：<a href="http://www.w3cplus.com/css/the-definitive-guide-to-using-negative-margins.html" target="_blank" rel="external">http://www.w3cplus.com/css/the-definitive-guide-to-using-negative-margins.html</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://7xltvd.com1.z0.glb.clouddn.com/default_avatar.jpg" alt="zhanfang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">zhanfang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">詹方的个人博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">145</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">categories</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">79</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhanfang" target="_blank">GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2840048377/profile?topnav=1&wvr=6" target="_blank">Weibo</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.demozhan.com/default" target="_blank">我的作品</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhanfang</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
<div class="theme-info">© zhanfang 2015 陕ICP备15014665号-1</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhanfang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>

  <script>
    (function(){
        var bp = document.createElement('script');
        bp.src = '//push.zhanzhang.baidu.com/push.js';
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
  </script>

</body>
</html>
